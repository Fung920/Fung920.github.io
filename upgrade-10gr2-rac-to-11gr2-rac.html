<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Upgrade 10gr2 RAC to 11gr2 RAC - My Notebook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">










<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    

    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    My Wiki
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/">Home</a>
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Upgrade 10gr2 RAC to 11gr2 RAC
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2014-04-05T16:00:00.000Z" itemprop="datePublished">Apr 5 2014</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/oracle/">oracle</a>
        </span>
        
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>本文演示了如何从10gr2 RAC升级至11gr2 RAC，示例中的10g版本为10.2.0.4，可以直接升级至11.2.0.4。11g升级路径如下：
<a id="more"></a>
	<li>直接升级路径：9.2.0.8 +，10.1.0.5+，10.2.0.2+，11.1.0.6+</li>
	<li>9.0.1.3=&gt;9.0.1.4=&gt;10.2.0.4=&gt;11.2</li>
	<li>9.2.0.3=&gt;9.2.0.8=&gt;11.2</li>
一些语法及惯用语说明:</p>

<code>ORACLE_HOME</code>、<code>ORACLE_BASE</code>：Database软件安装目录<br>

<code>GRID_HOME</code>：11g Grid Infrastructure软件安装目录<br>

<code>CRS_HOME</code>：10g Clusterware安装目录<br>

<p>以#开头表示root用户执行，以$表示grid或者oracle用户执行，SQL&gt; 则表示SQL*Plus执行。
在升级前，有些地方需要注意:
	<li>CRS必须在DB前升级</li>
	<li>11g新版本带来很多改变，10g中的CRS和ASM HOME均不存在了，而是集中到同一个地方：GRID_HOME，同时也引进了SCAN的概念</li>
	<li>Raw Device在RAC升级中，仍旧支持OCR及Voting disk，但在全新的安装中，已经不支持裸设备存储OCR及Voting Disk了</li>
	<li>在11g中，GI的安装及管理用户单独分离出来，常见以grid命名。虽然仍然可以用同一用户安装维护，但Oracle强烈建议分开。</li>
	<li>在以前的版本中，ORACLE_HOME都在ORACLE_BASE目录下，但是在11g RAC中，GRID_HOME则不是在GRID_BASE中，两者是在同一级目录下。ORACLE_HOME则还是在ORACLE_BASE下。</li>
	<li>11g以后patch是和base一起的，因此不需要跟10g一样先安装base版本再打补丁。</li>
本次实验升级方法：以非滚动升级方式升级。
</p><h3>1.升级前准备</h3>
<h4>1.1.升级前信息收集</h4>
升级前后信息对比如下，在升级前，先要创建grid用户，创建相关目录并且赋权。
<p><img src="/images/upgrade10g211g.png"></p>
<h4>1.2.创建相关目录</h4>
在两个节点执行相同内容。
#创建grid用户，添加环境变量<br>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/u01/app]# useradd -u 54322 grid -g oinstall -G dba</span><br><span class="line">[root@oel1:/u01/app]# cat /home/grid/.bash_profile</span><br><span class="line">export TMP=/tmp</span><br><span class="line">export TMPDIR=$TMP</span><br><span class="line">export ORACLE_SID=+ASM1</span><br><span class="line">export ORACLE_BASE=/u01/app/grid</span><br><span class="line">export ORACLE_HOME=/u01/app/11gr2/grid</span><br><span class="line">export JAVA_HOME=$ORACLE_HOME/jdk</span><br><span class="line">export ORACLE_TERM=xterm</span><br><span class="line">export NLS_DATE_FORMAT=&quot;yyyy-mm-dd Hh34:MI:SS&quot;</span><br><span class="line">export ORA_NLS11=$ORACLE_HOME/nls/data</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br><span class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</span><br><span class="line">export PATH=/usr/sbin:$ORACLE_HOME/bin:$JAVA_HOME:$PATH</span><br><span class="line">export PS1=&apos;[$LOGNAME@$HOSTNAME:$PWD]$ &apos;</span><br><span class="line">umask 022</span><br><span class="line">export DISPLAY=192.168.56.1:0.0</span><br></pre></td></tr></table></figure>

#创建相关目录并且授权
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/u01/app]# mkdir -p /u01/app/grid/</span><br><span class="line">[root@oel1:/u01/app]# mkdir -p /u01/app/11gr2/grid</span><br><span class="line">[root@oel1:/u01/app]# chown -R grid:oinstall grid/</span><br><span class="line">[root@oel1:/u01/app]# chown -R grid:oinstall 11gr2/</span><br><span class="line">[grid@oel2:/u01/app]$ chmod g+w grid/</span><br><span class="line">[grid@oel2:/u01/app]$ chmod g+w 11gr2/</span><br><span class="line">[oracle@oel2:/u01/app/oracle/product]$ mkdir -p /u01/app/oracle/product/11gr2</span><br></pre></td></tr></table></figure>

#添加grid用户ssh等效性
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[grid@oel1:/home/grid]$ mkdir -p ~/.ssh</span><br><span class="line">[grid@oel1:/home/grid]$ mkdir -p ~/.ssh</span><br><span class="line">[grid@oel1:/home/grid]$ ssh-keygen -t rsa</span><br><span class="line">[grid@oel1:/home/grid]$ ssh-keygen -t dsa</span><br><span class="line">[grid@oel1:/home/grid]$ cd .ssh</span><br><span class="line">[grid@oel1:/home/grid/.ssh]$ touch authorized_keys</span><br><span class="line">[grid@oel1:/home/grid/.ssh]$ cat ~/.ssh/*.pub &gt;&gt;authorized_keys</span><br><span class="line">[grid@oel1:/home/grid/.ssh]$ ssh oel1 cat ~/.ssh/id_rsa.pub &gt;&gt;authorized_keys</span><br><span class="line">[grid@oel1:/home/grid/.ssh]$ ssh oel2 cat ~/.ssh/id_rsa.pub &gt;&gt;authorized_keys</span><br><span class="line">[grid@oel1:/home/grid/.ssh]$ scp authorized_keys oel2:.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

验证并且通过测试。
<h4>1.3.验证安装条件</h4>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查看rpm包是否齐全：</span><br><span class="line">[root@oel1:/u01/app]# rpm -q binutils compat-libstdc++-33 elfutils-libelf \</span><br><span class="line">elfutils-libelf-devel elfutils-libelf-devel-static \</span><br><span class="line">gcc gcc-c++ glibc glibc-common glibc-devel \</span><br><span class="line">glibc-headers kernel-headers ksh libaio libaio-devel \</span><br><span class="line">libgcc libgomp libstdc++ libstdc++-devel make \</span><br><span class="line">numactl-devel sysstat unixODBC unixODBC-devel</span><br><span class="line">#将没安装的包安装上：</span><br><span class="line">[root@oel1:/u01/app]# mount /dev/cdrom /mnt</span><br><span class="line">[root@oel1:/u01/app]# yum install -y numactl-devel</span><br><span class="line">#两个节点安装cvu包：</span><br><span class="line">[root@oel1:/u01/worktmp/11gr2/grid/rpm]# rpm -ivh cvuqdisk-1.0.9-1.rpm</span><br></pre></td></tr></table></figure>

<h4>1.4.SCAN DNS设置</h4>
本例中SCAN的名字为rac-scan.kkdba.com。IP地址如下：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@oel2:/u01/app]# cat /etc/hosts</span><br><span class="line"># Do not remove the following line, or various programs</span><br><span class="line"># that require network functionality will fail.</span><br><span class="line">127.0.0.1               localhost.localdomain localhost</span><br><span class="line"></span><br><span class="line">#Public</span><br><span class="line">192.168.56.123  oel1.kkdba.com       oel1</span><br><span class="line">192.168.56.124  oel2.kkdba.com       oel2</span><br><span class="line"></span><br><span class="line">#Vip</span><br><span class="line">192.168.56.125  orcl1-vip.kkdba.com  orcl1-vip</span><br><span class="line">192.168.56.126  orcl2-vip.kkdba.com  orcl2-vip</span><br><span class="line"></span><br><span class="line">#Private</span><br><span class="line">10.10.56.123    orcl1-prv</span><br><span class="line">10.10.56.124    orcl2-prv</span><br><span class="line"></span><br><span class="line">#11gr2 SCAN</span><br><span class="line">#192.168.56.120 rac-scan.kkdba.com   rac-scan</span><br><span class="line">#192.168.56.121 rac-scan.kkdba.com   rac-scan</span><br><span class="line">#192.168.56.122 rac-scan.kkdba.com   rac-scan</span><br></pre></td></tr></table></figure>

<p>因在DNS中已经存在rac-scan的解析，因此/etc/hosts文件中取消此解析。11gr2 SCAN DNS简单设置请参照前文：
<a href="http://www.kkdba.com/11gr2-scan-dns.html">11gr2 RAC SCAN DNS Configuration</a>。
<!--[11gr2 RAC SCAN DNS Configuration](http://www.kkdba.com/oracle/11gr2-scan-dns.html)-->
</p><h4>1.5.NTP时间设置</h4>
在11gr2中，取消Linux自带的ntpd时间服务，而采用Oracle自带的CTSS(Cluster Time Synchronization Service)服务。因此，ntpd需要停止，以免造成冲突导致集群无法同步。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oel2:/u01/app]# /etc/init.d/ntpd status</span><br><span class="line">ntpd is stopped</span><br></pre></td></tr></table></figure>

两个节点的ntpd已经停止，10g的环境是采用rdate同步。直接屏蔽即可，同时移除ntp设定文档。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@oel2:/u01/app]# crontab -l</span><br><span class="line">*/1 * * * * rdate -s 192.168.56.123</span><br><span class="line">[root@oel1:/root]#  mv /etc/ntp.conf /etc/ntp.conf.org</span><br></pre></td></tr></table></figure>

<h4>1.6.创建GI使用的ASM磁盘组</h4>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/root]# /etc/init.d/oracleasm createdisk OCR1 /dev/sdh1</span><br><span class="line">Marking disk &quot;OCR1&quot; as an ASM disk: [  OK  ]</span><br><span class="line">[root@oel1:/root]# /etc/init.d/oracleasm createdisk OCR2 /dev/sdi1</span><br><span class="line">Marking disk &quot;OCR2&quot; as an ASM disk: [  OK  ]</span><br><span class="line">[root@oel1:/root]# /etc/init.d/oracleasm createdisk OCR3 /dev/sdj1</span><br><span class="line">Marking disk &quot;OCR3&quot; as an ASM disk: [  OK  ]</span><br><span class="line">[root@oel2:/root]# /etc/init.d/oracleasm listdisks</span><br><span class="line">OCR1</span><br><span class="line">OCR2</span><br><span class="line">OCR3</span><br><span class="line">DATA1</span><br></pre></td></tr></table></figure>

<h4>1.7.备份数据库</h4>
在升级前先做好备份，可以用于紧急回退。需要备份的数据有OCR，Votiedisk，ORACLE_HOME目录，CRS_HOME目录及数据库RMAN备份。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#节点1：</span><br><span class="line">[root@oel1:/backup]# dd if=/dev/raw/raw1 of=./ocr_disk_10gr2.bk</span><br><span class="line">401562+0 records in</span><br><span class="line">401562+0 records out</span><br><span class="line">205599744 bytes (206 MB) copied, 214.279 seconds, 959 kB/s</span><br><span class="line">[root@oel1:/backup]# dd if=/dev/raw/raw3 of=votedisk_10gr2.bk</span><br><span class="line">401562+0 records in</span><br><span class="line">401562+0 records out</span><br><span class="line">205599744 bytes (206 MB) copied, 233.01 seconds, 882 kB/s</span><br></pre></td></tr></table></figure>

	注意，OCR备份方式也可以使用Oracle自带命令。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/backup]# /u01/app/oracle/product/crs/bin/ocrconfig -export /backup/ocr.dmp</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#备份软件HOME目录：</span><br><span class="line">[root@oel1:/backup]# tar -cvzf oel1.crs.tgz /u01/app/oracle/product/crs/*</span><br><span class="line">[root@oel1:/backup]# tar -cvzf oel1.db.tgz /u01/app/oracle/product/10.2.0/db_1/*</span><br><span class="line">[root@oel1:/backup]# cp /etc/inittab etc_inittab</span><br><span class="line">[root@oel1:/backup]# mkdir ./etc_init.d/</span><br><span class="line">[root@oel1:/backup]# cp /etc/init.d/init.* ./etc_init.d/</span><br><span class="line">[root@oel1:/backup]# tar -cvzf oel1.etcoracle.tgz /etc/oracle/*</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#节点2：</span><br><span class="line">[root@oel2:/backup]# tar -cvzf oel2.crs.tgz /u01/app/oracle/product/crs/*</span><br><span class="line">[root@oel2:/backup]# tar -cvzf oel2.db.tgz /u01/app/oracle/product/10.2.0/db_1/*</span><br><span class="line">[root@oel2:/backup]# tar -cvzf oel2.etcoracle.tgz /etc/oracle/*</span><br><span class="line">[root@oel2:/backup]# cp /etc/inittab /backup/etc_inittab</span><br><span class="line">[root@oel2:/backup]# mkdir -p /backup/etc_init.d/</span><br><span class="line">[root@oel2:/backup]# cp /etc/init.d/init* /backup/etc_init.d/</span><br></pre></td></tr></table></figure>

RMAN全备数据库：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">run &#123;</span><br><span class="line">ALLOCATE CHANNEL ch00 TYPE DISK;</span><br><span class="line">ALLOCATE CHANNEL ch01 TYPE DISK;</span><br><span class="line">sql &apos;alter system archive log current&apos;;</span><br><span class="line">BACKUP</span><br><span class="line">AS BACKUPSET</span><br><span class="line">SKIP INACCESSIBLE</span><br><span class="line">TAG hot_db_bk_level0 FORMAT &apos;/backup/rman/bk_%s_%p_%U_%T_%d&apos;</span><br><span class="line">FULL  DATABASE;</span><br><span class="line">sql &apos;alter system archive log current&apos;;</span><br><span class="line">sql &apos;alter system archive log current&apos;;</span><br><span class="line">sql &apos;alter system archive log current&apos;;</span><br><span class="line">backup archivelog all delete input format &apos;/backup/rman/arch_%U_%T_%d&apos;;</span><br><span class="line">backup current controlfile tag &apos;ctl&apos; format &apos;/backup/rman/ctl_%U_%T_%d&apos;;</span><br><span class="line">RELEASE CHANNEL ch00;</span><br><span class="line">RELEASE CHANNEL ch01;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

如果有EM，需要停止EM。如有需要，可以关闭归档。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emctl stop dbconsole</span><br></pre></td></tr></table></figure>

<h3>2.非滚动升级</h3>
为了安装11g GI，需要屏蔽掉10g的CRS，否则两者会有冲突。滚动升级不需要此步骤。
<h4>2.1.关闭CRS</h4>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/root]# /u01/app/oracle/product/crs/bin/crsctl stop crs</span><br><span class="line">[root@oel2:/root]# /u01/app/oracle/product/crs/bin/crsctl stop crs</span><br></pre></td></tr></table></figure>

<h4>2.2.重命名CRS相关文件及目录</h4>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/root]# mv /etc/oracle /etc/oracle_orig</span><br><span class="line">[root@oel1:/root]# mkdir /etc/init.d/bk</span><br><span class="line">[root@oel1:/root]# mv /etc/init.d/init* /etc/init.d/bk</span><br><span class="line">[root@oel2:/root]# mv /etc/oracle /etc/oracle_orig</span><br><span class="line">[root@oel2:/root]# mkdir /etc/init.d/bk</span><br><span class="line">[root@oel2:/root]# mv /etc/init.d/init* /etc/init.d/bk</span><br></pre></td></tr></table></figure>

<h4>2.3.两个节点屏蔽/etc/inittab中RAC启动相关选项</h4>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@oel2:/backup]# tail -5 /etc/inittab</span><br><span class="line"># Run xdm in runlevel 5</span><br><span class="line">x:5:respawn:/etc/X11/prefdm -nodaemon</span><br><span class="line">#h1:35:respawn:/etc/init.d/init.evmd run &gt;/dev/null 2&gt;&amp;1 &lt;/dev/null</span><br><span class="line">#h3:35:respawn:/etc/init.d/init.cssd fatal &gt;/dev/null 2&gt;&amp;1 &lt;/dev/null</span><br><span class="line">#h4:35:respawn:/etc/init.d/init.crsd run &gt;/dev/null 2&gt;&amp;1 &lt;/dev/null</span><br></pre></td></tr></table></figure>

<h4>2.4.删除网络接口文件</h4>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/root]# rm -rf /var/tmp/.oracle</span><br><span class="line">[root@oel2:/root]# rm -rf /var/tmp/.oracle</span><br><span class="line">[root@oel2:/root]# rm -rf /tmp/.oracle/</span><br><span class="line">[root@oel1:/root]# rm -rf /tmp/.oracle/</span><br></pre></td></tr></table></figure>

<h4>2.5.重启系统</h4>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/root]# shutdown -ry 0</span><br><span class="line">[root@oel2:/root]# shutdown -ry 0</span><br></pre></td></tr></table></figure>

<h3>3.安装Grid Infrastructure</h3>
以grid用户执行安装
export CVUQDISK_GRP=oinstall
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#安装前检查：</span><br><span class="line">[grid@oel1:/u01/worktmp/11gr2/grid]$ ./runcluvfy.sh stage -pre crsinst \</span><br><span class="line">-n oel1,oel2 -fixup -fixupdir /home/grid/ -verbose</span><br></pre></td></tr></table></figure>

以root用户执行输出脚本
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#安装步骤：</span><br><span class="line">[grid@oel1:/u01/worktmp/11gr2/grid]$ ./runInstaller</span><br><span class="line">Download Software Update:Skip</span><br><span class="line">Select Installation Option: Install and Configure Grid Infrastructure for a Cluster</span><br><span class="line">Select Installation Type:Advanced Installation</span><br><span class="line">Select Product Language: English &amp; Simplified Chinese</span><br><span class="line">Grid Plug and Play Information:</span><br><span class="line">	Cluster Name:orcl</span><br><span class="line">	SCAN Name:rac-scan</span><br><span class="line">	SCAN port:1521</span><br><span class="line">Cluster Node Information: refer to /etc/hosts</span><br><span class="line">Specify Network Interface Usage:</span><br><span class="line">Storage Option Information:ASM</span><br><span class="line">Create ASM Disk Group:</span><br><span class="line">	DG Name:CRS</span><br><span class="line">	Redundency:Normal</span><br><span class="line">	Change Discovery Path:/dev/oracleasm/disks/*</span><br><span class="line">Specify ASM Password:</span><br><span class="line">Failure Isolation Support: Do not use IPMI</span><br><span class="line">Privileged OS Group:default</span><br><span class="line">Specify Installation Home:</span><br><span class="line">	Oracle Base:/u01/app/grid</span><br><span class="line">	Software Location:/u01/app/11gr2/grid</span><br></pre></td></tr></table></figure>

安装完成以root用户执行/u01/app/11gr2/grid/root.sh脚本。脚本完成后，11gr2的高可用服务(CRS，CSS及EVMD)就起来了。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#确认GI集群状态：</span><br><span class="line">[grid@oel1:/worktmp/11g/grid]$ crsctl query crs activeversion</span><br><span class="line">Oracle Clusterware active version on the cluster is [11.2.0.4.0]</span><br><span class="line">[grid@oel1:/worktmp/11g/grid]$ crsctl query crs softwareversion</span><br><span class="line">Oracle Clusterware version on node [oel1] is [11.2.0.4.0]</span><br><span class="line">[grid@oel1:/worktmp/11g/grid]$ ocrcheck</span><br><span class="line">Status of Oracle Cluster Registry is as follows :</span><br><span class="line">         Version                  :          3</span><br><span class="line">         Total space (kbytes)     :     262120</span><br><span class="line">         Used space (kbytes)      :       2832</span><br><span class="line">         Available space (kbytes) :     259288</span><br><span class="line">         ID                       : 1417014589</span><br><span class="line">         Device/File Name         :       +CRS</span><br><span class="line">                                    Device/File integrity check succeeded</span><br><span class="line"></span><br><span class="line">                                   Device/File not configured</span><br><span class="line"></span><br><span class="line">                                   Device/File not configured</span><br><span class="line"></span><br><span class="line">                                   Device/File not configured</span><br><span class="line"></span><br><span class="line">                                   Device/File not configured</span><br><span class="line"></span><br><span class="line">        Cluster registry integrity check succeeded</span><br><span class="line"></span><br><span class="line">        Logical corruption check bypassed due to non-privileged user</span><br><span class="line">[grid@oel1:/worktmp/11g/grid]$ crsctl query css votedisk</span><br><span class="line">##  STATE    File Universal Id                File Name Disk group</span><br><span class="line">--  -----    -----------------                --------- ---------</span><br><span class="line"> 1. ONLINE   3756bd45b9214f22bf4f45e87da09fa8 (/dev/oracleasm/disks/OCR1) [CRS]</span><br><span class="line"> 2. ONLINE   2968da754a974fc1bf86b19fb18afad5 (/dev/oracleasm/disks/OCR2) [CRS]</span><br><span class="line"> 3. ONLINE   2e7ea902e0514f97bf258b70d975a9b6 (/dev/oracleasm/disks/OCR3) [CRS]</span><br><span class="line">Located 3 voting disk(s).</span><br><span class="line">[root@oel1:/root]# /u01/app/11gr2/grid/bin/crsctl stat res -t</span><br><span class="line">[root@oel1:/root]# /u01/app/11gr2/grid/bin/crsctl check cluster -all</span><br><span class="line">**************************************************************</span><br><span class="line">oel1:</span><br><span class="line">CRS-4537: Cluster Ready Services is online</span><br><span class="line">CRS-4529: Cluster Synchronization Services is online</span><br><span class="line">CRS-4533: Event Manager is online</span><br><span class="line">**************************************************************</span><br><span class="line">oel2:</span><br><span class="line">CRS-4537: Cluster Ready Services is online</span><br><span class="line">CRS-4529: Cluster Synchronization Services is online</span><br><span class="line">CRS-4533: Event Manager is online</span><br><span class="line">**************************************************************</span><br><span class="line">[root@oel1:/root]# /u01/app/11gr2/grid/bin/crsctl check ctss</span><br><span class="line">CRS-4701: The Cluster Time Synchronization Service is in Active mode.</span><br><span class="line">CRS-4702: Offset (in msec): 0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">#确认集群状态无误后查看监听配置情况：</span><br><span class="line">[grid@oel2:/home/grid]$ srvctl config listener -l listener</span><br><span class="line">Name: LISTENER</span><br><span class="line">Network: 1, Owner: grid</span><br><span class="line">Home: &lt;crs home&gt;</span><br><span class="line">End points: TCP:1521</span><br><span class="line">[grid@oel2:/home/grid]$ crs_stat -t</span><br><span class="line">Name           Type           Target    State     Host</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">ora....ER.lsnr ora....er.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....N1.lsnr ora....er.type ONLINE    ONLINE    oel2</span><br><span class="line">ora....N2.lsnr ora....er.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....N3.lsnr ora....er.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.OCR.dg     ora....up.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.asm        ora.asm.type   ONLINE    ONLINE    oel1</span><br><span class="line">ora.cvu        ora.cvu.type   ONLINE    ONLINE    oel1</span><br><span class="line">ora.gsd        ora.gsd.type   OFFLINE   OFFLINE</span><br><span class="line">ora....network ora....rk.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.oc4j       ora.oc4j.type  ONLINE    ONLINE    oel1</span><br><span class="line">ora....SM1.asm application    ONLINE    ONLINE    oel1</span><br><span class="line">ora....L1.lsnr application    ONLINE    ONLINE    oel1</span><br><span class="line">ora.oel1.gsd   application    OFFLINE   OFFLINE</span><br><span class="line">ora.oel1.ons   application    ONLINE    ONLINE    oel1</span><br><span class="line">ora.oel1.vip   ora....t1.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....SM2.asm application    ONLINE    ONLINE    oel2</span><br><span class="line">ora....L2.lsnr application    ONLINE    ONLINE    oel2</span><br><span class="line">ora.oel2.gsd   application    OFFLINE   OFFLINE</span><br><span class="line">ora.oel2.ons   application    ONLINE    ONLINE    oel2</span><br><span class="line">ora.oel2.vip   ora....t1.type ONLINE    ONLINE    oel2</span><br><span class="line">ora.ons        ora.ons.type   ONLINE    ONLINE    oel1</span><br><span class="line">ora....ry.acfs ora....fs.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.scan1.vip  ora....ip.type ONLINE    ONLINE    oel2</span><br><span class="line">ora.scan2.vip  ora....ip.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.scan3.vip  ora....ip.type ONLINE    ONLINE    oel1</span><br><span class="line">[grid@oel2:/home/grid]$ crsctl stat res -t</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">NAME           TARGET  STATE        SERVER                   STATE_DETAILS</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Local Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.LISTENER.lsnr</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.OCR.dg</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.asm</span><br><span class="line">               ONLINE  ONLINE       oel1                     Started</span><br><span class="line">               ONLINE  ONLINE       oel2                     Started</span><br><span class="line">ora.gsd</span><br><span class="line">               OFFLINE OFFLINE      oel1</span><br><span class="line">               OFFLINE OFFLINE      oel2</span><br><span class="line">ora.net1.network</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.ons</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.registry.acfs</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Cluster Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.LISTENER_SCAN1.lsnr</span><br><span class="line">      1        ONLINE  ONLINE       oel2</span><br><span class="line">ora.LISTENER_SCAN2.lsnr</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.LISTENER_SCAN3.lsnr</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.cvu</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.oc4j</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.oel1.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.oel2.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel2</span><br><span class="line">ora.scan1.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel2</span><br><span class="line">ora.scan2.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.scan3.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">[grid@oel2:/home/grid]$</span><br></pre></td></tr></table></figure>

	以上为整个GI集群状态。
<h3>4.迁移10g ASM磁盘组</h3>
将原来数据文件存放的ASM磁盘迁移至11gr2 GI管理。先用grid用户调用asmca，利用asmca挂载原有磁盘组DATA1，这样，DATA1磁盘组就能自动在GI里面注册了。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[grid@oel1:/home/grid]$ asmca</span><br></pre></td></tr></table></figure>

<p><img src="/images/asmca.png"></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#查看ASM磁盘组状态，以grid用户调用SQLPLUS：</span><br><span class="line">SQL&gt; col path for a30</span><br><span class="line">SQL&gt; col instance_name for a10</span><br><span class="line">SQL&gt; select name,state,type,total_mb,free_mb</span><br><span class="line">from gv$asm_diskgroup;</span><br><span class="line">NAME                           STATE       TYPE     TOTAL_MB    FREE_MB</span><br><span class="line">------------------------------ ----------- ------ ---------- ----------</span><br><span class="line">OCR                            MOUNTED     NORMAL       3057       2131</span><br><span class="line">DATA                           MOUNTED     EXTERN       8189       6918</span><br><span class="line">OCR                            MOUNTED     NORMAL       3057       2131</span><br><span class="line">DATA                           MOUNTED     EXTERN       8189       6918</span><br><span class="line">SQL&gt; select group_number,path,state,total_mb,free_mb</span><br><span class="line">from v$asm_disk;</span><br><span class="line">GROUP_NUMBER PATH                           STATE      TOTAL_MB    FREE_MB</span><br><span class="line">------------ ------------------------------ -------- ---------- ----------</span><br><span class="line">           1 /dev/oracleasm/disks/OCR3      NORMAL         1019        710</span><br><span class="line">           1 /dev/oracleasm/disks/OCR2      NORMAL         1019        710</span><br><span class="line">           1 /dev/oracleasm/disks/OCR1      NORMAL         1019        711</span><br><span class="line">           2 /dev/oracleasm/disks/DATA1      NORMAL         8189       6919</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#从inventory删除旧的crs home。Detach Old CRS home from Inventory</span><br><span class="line">[grid@oel1:/worktmp/11g/grid]$  /u01/app/oracle/product/crs/oui/bin/runInstaller \</span><br><span class="line">-detachHome -silent -local ORACLE_HOME=/u01/app/oracle/product/crs</span><br><span class="line">Starting Oracle Universal Installer...</span><br><span class="line">No pre-requisite checks found in oraparam.ini, no system pre-requisite checks will be executed.</span><br><span class="line">The inventory pointer is located at /etc/oraInst.loc</span><br><span class="line">The inventory is located at /u01/app/oracle/oraInventory</span><br><span class="line">&apos;DetachHome&apos; was successful.</span><br></pre></td></tr></table></figure>

<h3>5.升级10g数据库
<h4>5.1.安装11gr2 Database软件</h4></h3>
以oracle用户安装11gr2软件至NEW ORACLE_HOME目录，建议的做法是备份原先的profile，重新使用新的profile，主要修改ORACLE_HOME变量：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/home/oracle]$ cp .bash_profile .profile</span><br><span class="line">export EDITOR=vi</span><br><span class="line"># User specific environment and startup programs</span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line">export ORACLE_BASE=/u01/app/oracle</span><br><span class="line">#export ORA_CRS_HOME=$ORACLE_BASE/product/crs</span><br><span class="line">#export ORACLE_HOME=$ORACLE_BASE/product/10.2.0/db_1</span><br><span class="line">export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1</span><br><span class="line">export ORACLE_SID=orcl1</span><br><span class="line">export PATH=.:$&#123;PATH&#125;:$HOME/bin:$ORACLE_BASE/product/crs/bin:$ORACLE_HOME/bin</span><br><span class="line">export PATH=$&#123;PATH&#125;:/usr/bin:/bin:/usr/bin/X11:/usr/local/bin</span><br><span class="line">export PATH=$&#123;PATH&#125;:$ORACLE_BASE/common/oracle/bin:$ORACLE_BASE/product/crs/bin</span><br><span class="line">export ORACLE_TERM=xterm</span><br><span class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</span><br><span class="line">#export ORA_NLS10=$ORACLE_HOME/nls/data</span><br><span class="line">export ORA_NLS11=$ORACLE_HOME/nls/data</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib</span><br><span class="line">export LD_LIBRARY_PATH=$&#123;LD_LIBRARY_PATH&#125;:$ORACLE_HOME/oracm/lib</span><br><span class="line">export LD_LIBRARY_PATH=$&#123;LD_LIBRARY_PATH&#125;:/lib:/usr/lib:/usr/local/lib</span><br><span class="line">export CLASSPATH=$ORACLE_HOME/JRE</span><br><span class="line">export CLASSPATH=$&#123;CLASSPATH&#125;:$ORACLE_HOME/jlib</span><br><span class="line">export CLASSPATH=$&#123;CLASSPATH&#125;:$ORACLE_HOME/rdbms/jlib</span><br><span class="line">export CLASSPATH=$&#123;CLASSPATH&#125;:$ORACLE_HOME/network/jlib</span><br><span class="line">export THREADS_FLAG=native</span><br><span class="line">export TEMP=/tmp</span><br><span class="line">export TMPDIR=/tmp</span><br><span class="line">export DISPLAY=192.168.56.1:0.0</span><br><span class="line">export PS1=&apos;[$LOGNAME@$HOSTNAME:$PWD]$ &apos;</span><br><span class="line">umask 022</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#安装步骤如下：</span><br><span class="line">[oracle@oel1:/u01/worktmp/11gr2/database]$ ./runInstaller</span><br><span class="line">Configure Security Updates：None</span><br><span class="line">Down Software Updates：Skip software updates</span><br><span class="line">Installation Option：Install Database software only</span><br><span class="line">Grid Installation Option：select ALL NODES</span><br><span class="line">Product Language：English &amp; Simplified Chinese</span><br><span class="line">Installation Location：</span><br><span class="line">	ORACLE_BASE：/u01/app/oracle</span><br><span class="line">	ORACLE_HOME：/u01/app/oracle/product/11.2.0/db_1</span><br><span class="line">Operating System Groups：</span><br><span class="line">	OSDBA：dba</span><br><span class="line">	OSOPER：NONE</span><br></pre></td></tr></table></figure>

安装完成后，两个节点复制相关到11G目录下
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@oel2:/root]# cp /u01/app/oracle/product/10.2.0/db_1/network/admin/tnsnames.ora /u01/app/oracle/product/11.2.0/db_1/network/admin/</span><br><span class="line">[root@oel1:/root]# cp /u01/app/oracle/product/10.2.0/db_1/network/admin/tnsnames.ora /u01/app/oracle/product/11.2.0/db_1/network/admin/</span><br><span class="line">[oracle@oel1:/home/oracle]$ scp /u01/app/oracle/product/10.2.0/db_1/dbs/orapworcl1 $ORACLE_HOME/dbs</span><br><span class="line">[oracle@oel2:/home/oracle]$ scp /u01/app/oracle/product/10.2.0/db_1/dbs/orapworcl2 $ORACLE_HOME/dbs</span><br></pre></td></tr></table></figure>

<h4>5.2.手工升级数据库</h4>
修改初始化文件，由于10G的rac spfile在共享磁盘上，因此，先需要从ASM中复制到文件系统，这一步可以在停止CRS前做。
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[grid@oel2:/home/grid]$ asmcmd -p</span><br><span class="line">ASMCMD [+] &gt; ls</span><br><span class="line">CRS/</span><br><span class="line">DATA/</span><br><span class="line">ASMCMD [+] &gt; cd data</span><br><span class="line">ASMCMD [+data] &gt; ls</span><br><span class="line">ORCL/</span><br><span class="line">arch/</span><br><span class="line">ASMCMD [+data] &gt; cd orcl</span><br><span class="line">ASMCMD [+data/orcl] &gt; ls</span><br><span class="line">ARCHIVELOG/</span><br><span class="line">CONTROLFILE/</span><br><span class="line">DATAFILE/</span><br><span class="line">ONLINELOG/</span><br><span class="line">PARAMETERFILE/</span><br><span class="line">TEMPFILE/</span><br><span class="line">spfileorcl.ora</span><br><span class="line">ASMCMD [+data/orcl] &gt; cp spfileorcl.ora /tmp</span><br><span class="line">copying +data/orcl/spfileorcl.ora -&gt; /tmp/spfileorcl.ora</span><br><span class="line">SQL&gt; create pfile=&apos;/tmp/init.ora&apos; from spfile=&apos;/tmp/spfileorcl.ora&apos;;</span><br><span class="line">File created.</span><br></pre></td></tr></table></figure>

移除11g废弃参数，如background_dump_dest，user_dump_dest等，改为11g的diagnostic_dest。修改版本兼容号compatible，修改cluster_database=false。屏蔽掉监听参数。修改后对比如下：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/home/oracle]$ cat /u01/app/oracle/product/11.2.0/db_1/dbs/initorcl1.ora</span><br><span class="line">orcl2.__db_cache_size=427819008</span><br><span class="line">orcl1.__db_cache_size=427819008</span><br><span class="line">orcl2.__java_pool_size=4194304</span><br><span class="line">orcl1.__java_pool_size=4194304</span><br><span class="line">orcl2.__large_pool_size=4194304</span><br><span class="line">orcl1.__large_pool_size=4194304</span><br><span class="line">orcl2.__shared_pool_size=155189248</span><br><span class="line">orcl1.__shared_pool_size=155189248</span><br><span class="line">orcl2.__streams_pool_size=0</span><br><span class="line">orcl1.__streams_pool_size=0</span><br><span class="line">*.audit_file_dest=&apos;/u01/app/oracle/admin/orcl/adump&apos;</span><br><span class="line">#*.background_dump_dest=&apos;/u01/app/oracle/admin/orcl/bdump&apos;</span><br><span class="line">*.cluster_database_instances=2</span><br><span class="line">#*.cluster_database=true</span><br><span class="line">*.cluster_database=false</span><br><span class="line">#*.compatible=&apos;10.2.0.3.0&apos;</span><br><span class="line">*.compatible=&apos;11.2.0.0.0&apos;</span><br><span class="line">*.control_files=&apos;+DATA/orcl/controlfile/current.256.844116025&apos;</span><br><span class="line">*.core_dump_dest=&apos;/u01/app/oracle/admin/orcl/cdump&apos;</span><br><span class="line">*.db_block_size=8192</span><br><span class="line">*.db_create_file_dest=&apos;+DATA&apos;</span><br><span class="line">*.db_domain=&apos;&apos;</span><br><span class="line">*.db_file_multiblock_read_count=16</span><br><span class="line">*.db_name=&apos;orcl&apos;</span><br><span class="line">orcl2.instance_number=2</span><br><span class="line">orcl1.instance_number=1</span><br><span class="line">*.job_queue_processes=10</span><br><span class="line">*.log_archive_dest_1=&apos;LOCATION=+DATA/arch&apos;</span><br><span class="line">*.log_archive_format=&apos;%t_%s_%r.dbf&apos;</span><br><span class="line">*.open_cursors=300</span><br><span class="line">*.pga_aggregate_target=199229440</span><br><span class="line">*.processes=150</span><br><span class="line">#*.remote_listener=&apos;LISTENERS_ORCL&apos;</span><br><span class="line">*.remote_login_passwordfile=&apos;exclusive&apos;</span><br><span class="line">*.sga_target=597688320</span><br><span class="line">orcl2.thread=2</span><br><span class="line">orcl1.thread=1</span><br><span class="line">*.undo_management=&apos;AUTO&apos;</span><br><span class="line">orcl1.undo_tablespace=&apos;UNDOTBS1&apos;</span><br><span class="line">orcl2.undo_tablespace=&apos;UNDOTBS2&apos;</span><br><span class="line">#*.user_dump_dest=&apos;/u01/app/oracle/admin/orcl/udump&apos;</span><br><span class="line">*.diagnostic_dest=&apos;/u01/app/oracle&apos;</span><br></pre></td></tr></table></figure>

添加11g HOME目录到/etc/oratab
orcl:/u01/app/oracle/product/11.2.0/db_1:N
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#开始手工升级：</span><br><span class="line">[oracle@oel1:/home/oracle]$ export ORACLE_SID=orcl1</span><br><span class="line">[oracle@oel1:/home/oracle]$ export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1</span><br><span class="line">[oracle@oel1:/home/oracle]$ which sqlplus</span><br><span class="line">/u01/app/oracle/product/11.2.0/db_1/bin/sqlplus</span><br><span class="line">[oracle@oel1:/home/oracle]$ sqlplus &quot;/as sysdba&quot;</span><br><span class="line">SQL*Plus: Release 11.2.0.4.0 Production on Sun Apr 6 18:26:19 2014</span><br><span class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</span><br><span class="line">Connected to an idle instance.</span><br><span class="line">SQL&gt; startup upgrade</span><br><span class="line">ORACLE instance started.</span><br><span class="line">Total System Global Area  597098496 bytes</span><br><span class="line">Fixed Size                  2255552 bytes</span><br><span class="line">Variable Size             176162112 bytes</span><br><span class="line">Database Buffers          415236096 bytes</span><br><span class="line">Redo Buffers                3444736 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br><span class="line">SQL&gt; spool upgrade.log</span><br><span class="line">SQL&gt; @?/rdbms/admin/catupgrd.sql</span><br></pre></td></tr></table></figure>

在run上述脚本时候报了一个错误：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT TO_NUMBER(&apos;MUST_HAVE_RUN_PRE-UPGRADE_TOOL_FOR_TIMEZONE&apos;)</span><br><span class="line">                 *</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-01722: invalid number</span><br></pre></td></tr></table></figure>

为timezone的问题，MOS上解决方法，ID 1466464.1：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; CREATE TABLE registry$database(</span><br><span class="line">           platform_id   NUMBER,</span><br><span class="line">           platform_name VARCHAR2(101),</span><br><span class="line">           edition       VARCHAR2(30),</span><br><span class="line">           tz_version    NUMBER</span><br><span class="line">           );</span><br><span class="line">Table created.</span><br><span class="line">SQL&gt; truncate table registry$database;</span><br><span class="line">Table truncated.</span><br><span class="line">SQL&gt; INSERT into registry$database</span><br><span class="line">  (platform_id, platform_name, edition, tz_version)</span><br><span class="line">VALUES</span><br><span class="line">  ((select platform_id from v$database),</span><br><span class="line">   (select platform_name from v$database),</span><br><span class="line">   NULL,</span><br><span class="line">   (select version from v$timezone_file));</span><br><span class="line">1 row created.</span><br><span class="line">SQL&gt; commit;</span><br><span class="line">SQL&gt; col PLATFORM_NAME for a30</span><br><span class="line">SQL&gt; select * from sys.registry$database;</span><br><span class="line">PLATFORM_ID PLATFORM_NAME              EDITION                        TZ_VERSION</span><br><span class="line">----------- -------------------------- ------------------------------ ----------</span><br><span class="line">         13 Linux x86 64-bit                                                  14</span><br></pre></td></tr></table></figure>

再次执行升级脚本：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; spool upgrade.log</span><br><span class="line">SQL&gt; @?/rdbms/admin/catupgrd.sql</span><br></pre></td></tr></table></figure>

升级完后，会自动关闭数据库，以正常模式启动数据库，并执行以下查询：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; set lines 200;</span><br><span class="line">SQL&gt; set pages 1000;</span><br><span class="line">SQL&gt; column comp_name format a40;</span><br><span class="line">SQL&gt; column version format a12;</span><br><span class="line">SQL&gt; column status format a15;</span><br><span class="line">SQL&gt; select comp_name, version, status from dba_registry;</span><br><span class="line">COMP_NAME                                VERSION      STATUS</span><br><span class="line">---------------------------------------- ------------ ---------------</span><br><span class="line">Oracle Workspace Manager                 11.2.0.4.0   VALID</span><br><span class="line">Oracle Database Catalog Views            11.2.0.4.0   VALID</span><br><span class="line">Oracle Database Packages and Types       11.2.0.4.0   VALID</span><br><span class="line">Oracle Real Application Clusters         11.2.0.4.0   VALID</span><br><span class="line">SQL&gt; @?/rdbms/admin/utlu112s</span><br><span class="line">.</span><br><span class="line">Oracle Database 11.2 Post-Upgrade Status Tool           04-06-2014 19:29:05</span><br><span class="line">.</span><br><span class="line">Component                               Current      Version     Elapsed Time</span><br><span class="line">Name                                    Status       Number      HH:MM:SS</span><br><span class="line">.</span><br><span class="line">Oracle Server</span><br><span class="line">.                                         VALID      11.2.0.4.0  00:41:01</span><br><span class="line">Oracle Real Application Clusters</span><br><span class="line">.                                         VALID      11.2.0.4.0  00:00:02</span><br><span class="line">Oracle Workspace Manager</span><br><span class="line">.                                         VALID      11.2.0.4.0  00:01:29</span><br><span class="line">Final Actions</span><br><span class="line">.                                                                00:02:03</span><br><span class="line">Total Upgrade Time: 00:44:38</span><br><span class="line"></span><br><span class="line">PL/SQL procedure successfully completed.</span><br><span class="line"></span><br><span class="line">#执行脚本catuppst，This script will migrate the Baseline data on a pre-11g database to the 11g database.</span><br><span class="line">SQL&gt;  @?/rdbms/admin/catuppst.sql</span><br><span class="line">#编译非法对象</span><br><span class="line">SQL&gt; spool recompile.log</span><br><span class="line">SQL&gt;  @?/rdbms/admin/utlrp.sql</span><br><span class="line">#关闭数据库，修改参数文件，改为集群模式</span><br><span class="line">*.cluster_database=&apos;true&apos;</span><br><span class="line">*.remote_listener=&apos;rac-sca:1521&apos;</span><br></pre></td></tr></table></figure>

重启数据库，创建spfile，同时修改initorcl1.ora为以下内容：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create spfile=&apos;+DATA/orcl/spfileorcl.ora&apos; from pfile;</span><br><span class="line">[oracle@oel1:/home/oracle]$ cat /u01/app/oracle/product/11.2.0/db_1/dbs/initorcl1.ora</span><br><span class="line">SPFILE=&apos;+DATA/orcl/spfileorcl.ora&apos;</span><br><span class="line">#节点2拷贝</span><br><span class="line">[oracle@oel2:/home/oracle]$ cp /u01/app/oracle/product/10.2.0/db_1/dbs/initorcl2.ora $ORACLE_HOME/dbs/</span><br><span class="line">[oracle@oel2:/home/oracle]$ cat $ORACLE_HOME/dbs/initorcl2.ora</span><br><span class="line">SPFILE=&apos;+DATA/orcl/spfileorcl.ora&apos;</span><br><span class="line">SQL&gt; show parameter spfile</span><br><span class="line"></span><br><span class="line">NAME                                 TYPE        VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">spfile                               string      +DATA/orcl/spfileorcl.ora</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#关闭数据库，添加升级好的11g RAC到GI集群：</span><br><span class="line">[oracle@oel1:/home/oracle]$ srvctl add database -d orcl -m kkdba.com \</span><br><span class="line">-o /u01/app/oracle/product/11.2.0/db_1 -p +data/orcl/spfileorcl.ora -y AUTOMATIC</span><br><span class="line">[oracle@oel1:/home/oracle]$ srvctl add instance -d orcl -i orcl1 -n oel1</span><br><span class="line">[oracle@oel1:/home/oracle]$ srvctl add instance -d orcl -i orcl2 -n oel2</span><br><span class="line">[oracle@oel1:/home/oracle]$ srvctl modify database -d orcl -n orcl</span><br><span class="line">[oracle@oel1:/home/oracle]$ srvctl config database -d orcl -a</span><br><span class="line">Database unique name: orcl</span><br><span class="line">Database name: orcl</span><br><span class="line">Oracle home: /u01/app/oracle/product/11.2.0/db_1</span><br><span class="line">Oracle user: oracle</span><br><span class="line">Spfile: +data/orcl/spfileorcl.ora</span><br><span class="line">Domain: kkdba.com</span><br><span class="line">Start options: open</span><br><span class="line">Stop options: immediate</span><br><span class="line">Database role: PRIMARY</span><br><span class="line">Management policy: AUTOMATIC</span><br><span class="line">Server pools: orcl</span><br><span class="line">Database instances: orcl1,orcl2</span><br><span class="line">Disk Groups:</span><br><span class="line">Mount point paths:</span><br><span class="line">Services:</span><br><span class="line">Type: RAC</span><br><span class="line">Database is enabled</span><br><span class="line">Database is administrator managed</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#节点2 Detach 10g CRS_HOME</span><br><span class="line">[oracle@oel2:/home/oracle]$ /u01/app/oracle/product/crs/oui/bin/runInstaller \</span><br><span class="line">-detachHome -silent -local ORACLE_HOME=/u01/app/oracle/product/crs</span><br><span class="line">Starting Oracle Universal Installer...</span><br><span class="line">No pre-requisite checks found in oraparam.ini, no system pre-requisite checks will be executed.</span><br><span class="line">The inventory pointer is located at /etc/oraInst.loc</span><br><span class="line">The inventory is located at /u01/app/oracle/oraInventory</span><br><span class="line">&apos;DetachHome&apos; was successful.</span><br></pre></td></tr></table></figure>

通过srvctl启动集群数据库，并查看状态：
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/home/oracle]$ srvctl start database -d orcl</span><br><span class="line">[grid@oel1:/home/grid]$ crsctl stat res -t</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">NAME           TARGET  STATE        SERVER                   STATE_DETAILS</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Local Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.CRS.dg</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.DATA.dg</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.LISTENER.lsnr</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.asm</span><br><span class="line">               ONLINE  ONLINE       oel1                     Started</span><br><span class="line">               ONLINE  ONLINE       oel2                     Started</span><br><span class="line">ora.gsd</span><br><span class="line">               OFFLINE OFFLINE      oel1</span><br><span class="line">               OFFLINE OFFLINE      oel2</span><br><span class="line">ora.net1.network</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.ons</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">ora.registry.acfs</span><br><span class="line">               ONLINE  ONLINE       oel1</span><br><span class="line">               ONLINE  ONLINE       oel2</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Cluster Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.LISTENER_SCAN1.lsnr</span><br><span class="line">      1        ONLINE  ONLINE       oel2</span><br><span class="line">ora.LISTENER_SCAN2.lsnr</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.LISTENER_SCAN3.lsnr</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.cvu</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.oc4j</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.oel1.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.oel2.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel2</span><br><span class="line">ora.orcl.db</span><br><span class="line">      1        ONLINE  ONLINE       oel1                     Open</span><br><span class="line">      2        ONLINE  ONLINE       oel2                     Open</span><br><span class="line">ora.scan1.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel2</span><br><span class="line">ora.scan2.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">ora.scan3.vip</span><br><span class="line">      1        ONLINE  ONLINE       oel1</span><br><span class="line">[grid@oel1:/home/grid]$ crs_stat -t</span><br><span class="line">Name           Type           Target    State     Host</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">ora.CRS.dg     ora....up.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.DATA.dg    ora....up.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....ER.lsnr ora....er.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....N1.lsnr ora....er.type ONLINE    ONLINE    oel2</span><br><span class="line">ora....N2.lsnr ora....er.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....N3.lsnr ora....er.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.asm        ora.asm.type   ONLINE    ONLINE    oel1</span><br><span class="line">ora.cvu        ora.cvu.type   ONLINE    ONLINE    oel1</span><br><span class="line">ora.gsd        ora.gsd.type   OFFLINE   OFFLINE</span><br><span class="line">ora....network ora....rk.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.oc4j       ora.oc4j.type  ONLINE    ONLINE    oel1</span><br><span class="line">ora....SM1.asm application    ONLINE    ONLINE    oel1</span><br><span class="line">ora....L1.lsnr application    ONLINE    ONLINE    oel1</span><br><span class="line">ora.oel1.gsd   application    OFFLINE   OFFLINE</span><br><span class="line">ora.oel1.ons   application    ONLINE    ONLINE    oel1</span><br><span class="line">ora.oel1.vip   ora....t1.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....SM2.asm application    ONLINE    ONLINE    oel2</span><br><span class="line">ora....L2.lsnr application    ONLINE    ONLINE    oel2</span><br><span class="line">ora.oel2.gsd   application    OFFLINE   OFFLINE</span><br><span class="line">ora.oel2.ons   application    ONLINE    ONLINE    oel2</span><br><span class="line">ora.oel2.vip   ora....t1.type ONLINE    ONLINE    oel2</span><br><span class="line">ora.ons        ora.ons.type   ONLINE    ONLINE    oel1</span><br><span class="line">ora.orcl.db    ora....se.type ONLINE    ONLINE    oel1</span><br><span class="line">ora....ry.acfs ora....fs.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.scan1.vip  ora....ip.type ONLINE    ONLINE    oel2</span><br><span class="line">ora.scan2.vip  ora....ip.type ONLINE    ONLINE    oel1</span><br><span class="line">ora.scan3.vip  ora....ip.type ONLINE    ONLINE    oel1</span><br><span class="line">[oracle@oel1:/u01/app/oracle/product/10.2.0/db_1/network/admin]$ lsnrctl service</span><br><span class="line">LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 06-APR-2014 22:26:50</span><br><span class="line"></span><br><span class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))</span><br><span class="line">Services Summary...</span><br><span class="line">Service &quot;+ASM&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;+ASM1&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">    Handler(s):</span><br><span class="line">      &quot;DEDICATED&quot; established:0 refused:0 state:ready</span><br><span class="line">         LOCAL SERVER</span><br><span class="line">Service &quot;orcl&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;orcl1&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">    Handler(s):</span><br><span class="line">      &quot;DEDICATED&quot; established:0 refused:0 state:ready</span><br><span class="line">         LOCAL SERVER</span><br><span class="line">The command completed successfully</span><br></pre></td></tr></table></figure>


    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/rac/">#rac</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/upgrade/">#upgrade</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/nbu-lanfree-issue.html">nbu lanfree issue</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/10g-rac-command.html">10g rac管理命令</a>
            
        </span>
    </div>
    
</article>




    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2018 Kong&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
    
    
    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>