<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>installing 10gr2 rac on linux - My scratchpad</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="Oracle memoranda">



<meta name="keywords" content="oracle, database">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro|Calibri|Ubuntu">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    

    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    My Notebook
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/">Home</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            installing 10gr2 rac on linux
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2014-03-30T05:00:00.000Z" itemprop="datePublished">Mar 30 2014</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/oracle/">oracle</a>
        </span>
        
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
         实验环境：Oracle Enterprises Linux 5.8 x64 + Oracle 10gr2 RAC 
<a id="more"></a>
<pre>
OCR:/dev/raw/raw1,/dev/raw/raw2 
Votedisk:/dev/raw/raw3,/dev/raw/raw4,/dev/raw/raw5 
Datafile:ASM with OMF 
#IP规划如下： 
#public 
192.168.192.188         oel1.oraclema.com     oel1 
192.168.192.189         oel2.oraclema.com     oel2 
#VIP 
192.168.192.178         oel1-vip.oraclema.com oel1-vip 
192.168.192.179         oel2-vip.oraclema.com oel2-vip 
#heartbeat 
10.10.10.188            oel1-prv 
10.10.10.189            oel2-prv 
</pre>
 <h1>1.安装所需的包</h1>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# yum install oracle-validated </span><br><span class="line">[root@oel1 ~]# yum install oracleasm</span><br></pre></td></tr></table></figure>

 <h1>2.配置时间同步</h1>
以节点1为时间服务器，使用rdate进行时间同步 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# vi /etc/xinetd.d/time-stream </span><br><span class="line">修改disable=yes为disable=no </span><br><span class="line">启动xinetd </span><br><span class="line">[root@oel1 ~]# service xinetd start </span><br><span class="line">节点2同步： </span><br><span class="line">[root@oel2 yum.repos.d]# rdate -s oel1 </span><br><span class="line">[root@oel2 yum.repos.d]# crontab -l </span><br><span class="line">* * * * * rdate -s oel1</span><br></pre></td></tr></table></figure>

 <h1>3.裸设备设置</h1>
首先要对共享磁盘mapping过来的盘进行分区。确保一点节点分区完后，其他节点fdisk -l能正常扫描到。 

 	修改裸设备配置文件： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# cat /etc/udev/rules.d/60-raw.rules  </span><br><span class="line"># Enter raw device bindings here. </span><br><span class="line">#</span><br><span class="line"># An example would be: </span><br><span class="line">#   ACTION==&quot;add&quot;, KERNEL==&quot;sda&quot;, RUN+=&quot;/bin/raw /dev/raw/raw1 %N&quot; </span><br><span class="line"># to bind /dev/raw/raw1 to /dev/sda, or </span><br><span class="line">#   ACTION==&quot;add&quot;, ENV&#123;MAJOR&#125;==&quot;8&quot;, ENV&#123;MINOR&#125;==&quot;1&quot;, RUN+=&quot;/bin/raw /dev/raw/raw2 %M %m&quot; </span><br><span class="line"># to bind /dev/raw/raw2 to the device with major 8, minor 1. </span><br><span class="line">ACTION==&quot;add&quot;, KERNEL==&quot;sdb1&quot;,RUN+=&quot;/bin/raw /dev/raw/raw1 %N&quot; </span><br><span class="line">ACTION==&quot;add&quot;, KERNEL==&quot;sdc1&quot;,RUN+=&quot;/bin/raw /dev/raw/raw2 %N&quot; </span><br><span class="line">ACTION==&quot;add&quot;, KERNEL==&quot;sdd1&quot;,RUN+=&quot;/bin/raw /dev/raw/raw3 %N&quot; </span><br><span class="line">ACTION==&quot;add&quot;, KERNEL==&quot;sde1&quot;,RUN+=&quot;/bin/raw /dev/raw/raw4 %N&quot; </span><br><span class="line">ACTION==&quot;add&quot;, KERNEL==&quot;sdf1&quot;,RUN+=&quot;/bin/raw /dev/raw/raw5 %N&quot; </span><br><span class="line">ACTION==&quot;add&quot;, KERNEL==&quot;raw[1-5]&quot;, OWNER=&quot;oracle&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;</span><br></pre></td></tr></table></figure>

	启动udev服务，确保两个节点都能识别。 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# start_udev </span><br><span class="line">Starting udev: [  OK  ] </span><br><span class="line">[root@oel1 ~]# ll /dev/raw/raw* </span><br><span class="line">crw-rw---- 1 oracle oinstall 162, 1 Mar 27 16:57 /dev/raw/raw1 </span><br><span class="line">crw-rw---- 1 oracle oinstall 162, 2 Mar 27 16:57 /dev/raw/raw2 </span><br><span class="line">crw-rw---- 1 oracle oinstall 162, 3 Mar 27 16:57 /dev/raw/raw3 </span><br><span class="line">crw-rw---- 1 oracle oinstall 162, 4 Mar 27 16:57 /dev/raw/raw4 </span><br><span class="line">crw-rw---- 1 oracle oinstall 162, 5 Mar 27 16:57 /dev/raw/raw5</span><br></pre></td></tr></table></figure>

<h1>4.配置节点ssh信任</h1>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1 ~]$ mkdir ~/.ssh </span><br><span class="line">[oracle@oel2 ~]$ chmod 700 ~/.ssh </span><br><span class="line">[oracle@oel2 ~]$ ssh-keygen -t rsa </span><br><span class="line">[oracle@oel2 ~]$ ssh-keygen -t dsa </span><br><span class="line">[oracle@oel1 ~]$ cat ~/.ssh/*.pub &gt;&gt; ~/.ssh/authorized_keys </span><br><span class="line">#以上动作两个节点都需要做。 </span><br><span class="line">#节点1： </span><br><span class="line">[oracle@oel1 ~]$ cat ~/.ssh/*.pub &gt;&gt; ~/.ssh/authorized_keys </span><br><span class="line">[oracle@oel1 ~]$ scp ~/.ssh/authorized_keys oel2:~/.ssh/authorized_keys </span><br><span class="line">#节点2： </span><br><span class="line">[oracle@oel2 ~]$ cat ~/.ssh/*.pub &gt;&gt; ~/.ssh/authorized_keys </span><br><span class="line">[oracle@oel2 ~]$ scp ~/.ssh/authorized_keys oel1:~/.ssh/authorized_keys </span><br><span class="line">[oracle@oel2 ~]$ ssh oel1 date</span><br></pre></td></tr></table></figure>

<h1>5.创建所需目录</h1>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# mkdir -p /u01/app/oracle </span><br><span class="line">[root@oel1 ~]# mkdir -p /u01/app/oracle/product/crs </span><br><span class="line">[root@oel1 ~]# mkdir -p /u01/app/oracle/product/10.2.0/db_1 </span><br><span class="line">[root@oel1 ~]# chown -R oracle:oinstall /u01</span><br></pre></td></tr></table></figure>

<h1>6.修改内核参数</h1>
本实验采用oracle-validated，安装过程中会自动修改内核参数，只需要将11g的屏蔽，修改为10g的即可。修改完成后，使用以下命令使设置生效： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# sysctl -p </span><br><span class="line">net.ipv4.ip_forward = 0 </span><br><span class="line">net.ipv4.conf.default.rp_filter = 2 </span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0 </span><br><span class="line">kernel.core_uses_pid = 1 </span><br><span class="line">net.ipv4.tcp_syncookies = 1 </span><br><span class="line">fs.file-max = 6815744 </span><br><span class="line">kernel.msgmni = 2878 </span><br><span class="line">kernel.msgmax = 8192 </span><br><span class="line">kernel.msgmnb = 65536 </span><br><span class="line">kernel.sem = 250 32000 100 142 </span><br><span class="line">kernel.shmmni = 4096 </span><br><span class="line">kernel.shmall = 1073741824 </span><br><span class="line">kernel.shmmax = 4398046511104 </span><br><span class="line">kernel.sysrq = 1 </span><br><span class="line">net.core.rmem_default = 262144 </span><br><span class="line">net.core.rmem_max = 2097152 </span><br><span class="line">net.core.wmem_default = 262144 </span><br><span class="line">net.core.wmem_max = 262144 </span><br><span class="line">fs.aio-max-nr = 3145728 </span><br><span class="line">net.ipv4.ip_local_port_range = 1024 65000 </span><br><span class="line">vm.min_free_kbytes = 51200</span><br></pre></td></tr></table></figure>

<h1>7.配置IO Fencing</h1>
有关IO Fencing请看文章结尾说明。 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查找模块位置： </span><br><span class="line">[root@oel1 ~]# find /lib/modules -name &quot;hangcheck-timer.ko&quot; </span><br><span class="line">/lib/modules/2.6.32-300.10.1.el5uek/kernel/drivers/char/hangcheck-timer.ko </span><br><span class="line">/lib/modules/2.6.18-308.el5/kernel/drivers/char/hangcheck-timer.ko </span><br><span class="line">/lib/modules/2.6.32-300.10.1.el5uek.debug/kernel/drivers/char/hangcheck-timer.ko </span><br><span class="line">[root@oel1 ~]# modprobe hangcheck-timer </span><br><span class="line">#添加随机启动： </span><br><span class="line">vi /etc/rc.d/rc.local </span><br><span class="line">modprobe hangcheck-timer </span><br><span class="line">#配置模块参数： </span><br><span class="line">[root@rac1db ~]# vi /etc/modprobe.conf </span><br><span class="line">options hangcheck-timer hangcheck_tick=30 hangcheck_margin=180</span><br></pre></td></tr></table></figure>

<h1>8.ASMLib设置</h1>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# /etc/init.d/oracleasm configure </span><br><span class="line">[root@oel1 ~]# /etc/init.d/oracleasm createdisk DATA1 /dev/sdg1  </span><br><span class="line">Marking disk &quot;DATA1&quot; as an ASM disk: [  OK  ] </span><br><span class="line">#节点2扫描： </span><br><span class="line">[root@oel2 rules.d]# /etc/init.d/oracleasm scandisks </span><br><span class="line">Scanning the system for Oracle ASMLib disks: [  OK  ] </span><br><span class="line">[root@oel2 rules.d]# /etc/init.d/oracleasm listdisks </span><br><span class="line">DATA1</span><br></pre></td></tr></table></figure>

<h1>9.oracle用户环境变量</h1>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">export EDITOR=vi </span><br><span class="line"># User specific environment and startup programs </span><br><span class="line">PATH=$PATH:$HOME/bin </span><br><span class="line">export ORACLE_BASE=/u01/app/oracle </span><br><span class="line">export ORA_CRS_HOME=$ORACLE_BASE/product/crs </span><br><span class="line">export ORACLE_HOME=$ORACLE_BASE/product/10.2.0/db_1 </span><br><span class="line">#export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1 </span><br><span class="line">export ORACLE_SID=orcl1 </span><br><span class="line">export PATH=.:$&#123;PATH&#125;:$HOME/bin:$ORACLE_HOME/bin </span><br><span class="line">export PATH=$&#123;PATH&#125;:/usr/bin:/bin:/usr/bin/X11:/usr/local/bin </span><br><span class="line">export PATH=$&#123;PATH&#125;:$ORACLE_BASE/common/oracle/bin:$ORACLE_BASE/product/crs/bin </span><br><span class="line">export ORACLE_TERM=xterm </span><br><span class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin </span><br><span class="line">export ORA_NLS10=$ORACLE_HOME/nls/data </span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib </span><br><span class="line">export LD_LIBRARY_PATH=$&#123;LD_LIBRARY_PATH&#125;:$ORACLE_HOME/oracm/lib </span><br><span class="line">export LD_LIBRARY_PATH=$&#123;LD_LIBRARY_PATH&#125;:/lib:/usr/lib:/usr/local/lib </span><br><span class="line">export CLASSPATH=$ORACLE_HOME/JRE </span><br><span class="line">export CLASSPATH=$&#123;CLASSPATH&#125;:$ORACLE_HOME/jlib </span><br><span class="line">export CLASSPATH=$&#123;CLASSPATH&#125;:$ORACLE_HOME/rdbms/jlib </span><br><span class="line">export CLASSPATH=$&#123;CLASSPATH&#125;:$ORACLE_HOME/network/jlib </span><br><span class="line">export THREADS_FLAG=native </span><br><span class="line">export TEMP=/tmp </span><br><span class="line">export TMPDIR=/tmp </span><br><span class="line">export DISPLAY=192.168.56.1:0.0 </span><br><span class="line">export PS1=&apos;[$LOGNAME@$HOSTNAME:$PWD]$ &apos; </span><br><span class="line">umask 022</span><br></pre></td></tr></table></figure>

<h1>10.安装Clusterware软件</h1>
实验OS为OEL 5，因此需要修改Linux release：<br> 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1 ~]# cat /etc/redhat-release </span><br><span class="line">redhat-4</span><br></pre></td></tr></table></figure>

	安装步骤： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/worktmp/clusterware]$ ./runInstaller </span><br><span class="line">Specify Inventory directory and credentials： </span><br><span class="line">	Inventory:/u01/app/oracle/oraInventory </span><br><span class="line">	OS Group:oinstall </span><br><span class="line">Specify Home Detail: </span><br><span class="line">	Name:OraCrs10g_home </span><br><span class="line">	Path:/u01/app/oracle/product/crs </span><br><span class="line">Specify Cluster Configuration: </span><br><span class="line">	Cluster Name:orcl </span><br><span class="line">	Cluster Nodes:add all nodes information, you may need modify something </span><br><span class="line">Specify Network Interface Usage: </span><br><span class="line">	By default,there is no need modify. Please confirm with you network setting. </span><br><span class="line">Specify Oracle Cluster Registry Location: </span><br><span class="line">	Normal Redundancy,/dev/raw/raw1,/dev/raw/raw2 </span><br><span class="line">Specify Vote Disk Location: </span><br><span class="line">	Normal Redundancy,/dev/raw/raw3,/dev/raw/raw4,/dev/raw/raw5 </span><br><span class="line">#最后以root用户分别在两个节点执行以下脚本： </span><br><span class="line">/u01/app/oracle/oraInventory/orainstRoot.sh </span><br><span class="line">/u01/app/oracle/product/crs/root.sh</span><br></pre></td></tr></table></figure>

最后一个节点执行root.sh时候，最后执行vipca遇到 
<code>error while loading shared libraries: libpthread.so.0: cannot open shared object file: No such file or directory.</code>此错误为Redhat的bug。可以先不理会，打Patch至10.2.0.4，然后手工执行vipca。最后因为vip的原因会导致安装最后一步检查的过程报错：<br> 
<code>
 The "/u01/app/oracle/product/crs/cfgtoollogs/configToolFailedCommands" script contains all commands that failed, were skipped or were cancelled. This file may be used to run these configuration assistants outside of OUI. Note that you may have to update this script with passwords (if any) before executing the same. </code>
<br>
 可以手动执行<code>/u01/app/oracle/product/crs/cfgtoollogs/configToolFailedCommands</code>看看是什么错，一般就是VIP无法确认： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Checking existence of VIP node application (required) </span><br><span class="line">Check failed.  </span><br><span class="line">Check failed on nodes:  </span><br><span class="line">        oel2,oel1</span><br></pre></td></tr></table></figure>

<h1>11.Patch Clusterware</h1>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/u01/worktmp/10gr2/Disk1]$ ./runInstaller </span><br><span class="line">Specify Home Detail: </span><br><span class="line">	Name:OraCrs10g_home </span><br><span class="line">	Path:/u01/app/oracle/product/crs</span><br></pre></td></tr></table></figure>

其他的一切照默认安装。安装完后同样执行脚本：
<pre> 
[root@oel1:/u01/app/oracle]# /u01/app/oracle/product/crs/bin/crsctl stop crs 
Stopping resources. 
Successfully stopped CRS resources  
Stopping CSSD. 
Shutting down CSS daemon. 
Shutdown request successfully issued. 
[root@oel2:/u01/app/oracle]# /u01/app/oracle/product/crs/bin/crsctl stop crs 
Stopping resources. 
Successfully stopped CRS resources  
Stopping CSSD. 
Shutting down CSS daemon. 
Shutdown request successfully issued. 
[root@oel1:/u01/app/oracle]# /u01/app/oracle/product/crs/install/root102.sh 
[root@oel2:/u01/app/oracle]# /u01/app/oracle/product/crs/install/root102.sh 
#查看集群信息： 
[root@oel1:/u01/app/oracle/product/crs]# bin/crsctl check crs 
CSS appears healthy 
CRS appears healthy 
EVM appears healthy 
[root@oel1:/u01/app/oracle/product/crs]# bin/crsctl query css votedisk 
 0.     0    /dev/raw/raw3 
 1.     0    /dev/raw/raw4 
 2.     0    /dev/raw/raw5 

 located 3 votedisk(s). 
[root@oel1:/u01/app/oracle/product/crs]# bin/ocrcheck 
Status of Oracle Cluster Registry is as follows : 
         Version                  :          2 
         Total space (kbytes)     :     200560 
         Used space (kbytes)      :        544 
         Available space (kbytes) :     200016 
         ID                       :  841952053 
         Device/File Name         : /dev/raw/raw1 
                                    Device/File integrity check succeeded 
         Device/File Name         : /dev/raw/raw2 
                                    Device/File integrity check succeeded 

          Cluster registry integrity check succeeded 

</pre>
<h1>12.配置VIP资源</h1>
以root用户执行vipca，配置VIP信息: 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/u01/worktmp/10gr2/Disk1]$ which vipca </span><br><span class="line">/u01/app/oracle/product/crs/bin/vipca </span><br><span class="line">[root@oel1:/u01/app/oracle/product/crs]# export DISPLAY=192.168.56.1:0.0 </span><br><span class="line">[root@oel1:/u01/app/oracle/product/crs]# /u01/app/oracle/product/crs/bin/vipca </span><br><span class="line">#根据图形界面提示填入vip名称及ip地址。 </span><br><span class="line">#完成后可查看资源状态： </span><br><span class="line">[root@oel1:/u01/app/oracle/product/crs]# bin/crs_stat -t </span><br><span class="line">Name           Type           Target    State     Host         </span><br><span class="line">------------------------------------------------------------ </span><br><span class="line">ora.oel1.gsd   application    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.ons   application    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.vip   application    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel2.gsd   application    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.ons   application    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.vip   application    ONLINE    ONLINE    oel2</span><br></pre></td></tr></table></figure>

<h1>13.安装数据库软件</h1>  
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/u01/worktmp/10gr2/database]$ ./runInstaller </span><br><span class="line">Specify Installation Type： </span><br><span class="line">	Enterprise Edtion </span><br><span class="line">Specify Home Detail: </span><br><span class="line">	Name:OraDb10g_home </span><br><span class="line">	Path:/u01/app/oracle/product/10.2.0/db_1 </span><br><span class="line">Specify Hardware Cluster Installation Mode: </span><br><span class="line">	Cluster Installation:Select all nodes </span><br><span class="line">Select Configuration Option: </span><br><span class="line">	Install database Software Only </span><br><span class="line">#安装完成执行脚本： </span><br><span class="line">[root@oel1:/u01/app/oracle]#/u01/app/oracle/product/10.2.0/db_1/root.sh </span><br><span class="line">Running Oracle10 root.sh script... </span><br><span class="line"></span><br><span class="line"> The following environment variables are set as: </span><br><span class="line">    ORACLE_OWNER= oracle </span><br><span class="line">    ORACLE_HOME=  /u01/app/oracle/product/10.2.0/db_1 </span><br><span class="line"></span><br><span class="line"> Enter the full pathname of the local bin directory: [/usr/local/bin]:  </span><br><span class="line">   Copying dbhome to /usr/local/bin ... </span><br><span class="line">   Copying oraenv to /usr/local/bin ... </span><br><span class="line">   Copying coraenv to /usr/local/bin ... </span><br><span class="line"></span><br><span class="line"> Creating /etc/oratab file... </span><br><span class="line">Entries will be added to the /etc/oratab file as needed by </span><br><span class="line">Database Configuration Assistant when a database is created </span><br><span class="line">Finished running generic part of root.sh script. </span><br><span class="line">Now product-specific root actions will be performed.</span><br></pre></td></tr></table></figure>

<h1>14.Patch数据库软件</h1>
<pre>
[oracle@oel1:/u01/worktmp/10gr2/Disk1]$ ./runInstaller 
Specify Home Detail: 
	Name:OraDb10g_home 
	Path: /u01/app/oracle/product/10.2.0/db_1 
#其他的一切照默认安装。安装完后同样执行脚本： 
[root@oel1:/u01/app/oracle]# /u01/app/oracle/product/10.2.0/db_1/root.sh 
#Netca配置监听 
#完成后查看状态： 
[root@oel2:/u01/app/oracle/product/crs]# bin/crs_stat -t 
Name           Type           Target    State     Host         
------------------------------------------------------------ 
ora....L1.lsnr application    ONLINE    ONLINE    oel1         
ora.oel1.gsd   application    ONLINE    ONLINE    oel1         
ora.oel1.ons   application    ONLINE    ONLINE    oel1         
ora.oel1.vip   application    ONLINE    ONLINE    oel1         
ora....L2.lsnr application    ONLINE    ONLINE    oel2         
ora.oel2.gsd   application    ONLINE    ONLINE    oel2         
ora.oel2.ons   application    ONLINE    ONLINE    oel2         
ora.oel2.vip   application    ONLINE    ONLINE    oel2         

</pre>
<h1>15.dbca创建ASM实例</h1>
配置步骤如下： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Configure Automatic Storage Management </span><br><span class="line">Select All Nodes </span><br><span class="line">Enter SYS Password </span><br><span class="line">Initialization parameter file choose init file</span><br></pre></td></tr></table></figure>

创建完实例后，创建DATA磁盘组： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DiskGroup Name：DATA </span><br><span class="line">Redundancy：External </span><br><span class="line">Change Disk Discovery Path：/dev/oracleasm/disks/*</span><br></pre></td></tr></table></figure>

完成后查看DG状态： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel2:/home/oracle]$ export ORACLE_SID=+ASM2 </span><br><span class="line">[oracle@oel2:/home/oracle]$ sqlplus &quot;/as sysdba&quot; </span><br><span class="line">SQL&gt; select group_number,path,state,total_mb,free_mb </span><br><span class="line">from gv$asm_disk; </span><br><span class="line"></span><br><span class="line"> GROUP_NUMBER PATH                                               STATE      TOTAL_MB    FREE_MB </span><br><span class="line">------------ -------------------------------------------------- -------- ---------- ---------- </span><br><span class="line">           1 /dev/oracleasm/disks/DATA1                         NORMAL         8189       8096 </span><br><span class="line">           1 /dev/oracleasm/disks/DATA1                         NORMAL         8189       8096 </span><br><span class="line"></span><br><span class="line"> SQL&gt; select name,state,type,total_mb,free_mb </span><br><span class="line">from gv$asm_diskgroup;  </span><br><span class="line"></span><br><span class="line"> NAME                           STATE       TYPE     TOTAL_MB    FREE_MB </span><br><span class="line">------------------------------ ----------- ------ ---------- ---------- </span><br><span class="line">DATA                           MOUNTED     EXTERN       8189       8096 </span><br><span class="line">DATA                           MOUNTED     EXTERN       8189       8096</span><br></pre></td></tr></table></figure>

查看集群资源状态： 
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@oel1:/u01/app/oracle/product/crs]# bin/crs_stat -t -v </span><br><span class="line">Name           Type           R/RA   F/FT   Target    State     Host         </span><br><span class="line">---------------------------------------------------------------------- </span><br><span class="line">ora....SM1.asm application    0/5    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora....L1.lsnr application    0/5    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.gsd   application    0/5    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.ons   application    0/3    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.vip   application    0/0    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora....SM2.asm application    0/5    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora....L2.lsnr application    0/5    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.gsd   application    0/5    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.ons   application    0/3    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.vip   application    0/0    0/0    ONLINE    ONLINE    oel2 </span><br><span class="line">#为归档添加目录 </span><br><span class="line">export ORACLE_SID=+ASM1 </span><br><span class="line">asmcmd -p </span><br><span class="line">[oracle@oel2:/u01/app/oracle/admin/+ASM/bdump]$ asmcmd </span><br><span class="line">ASMCMD&gt; ls </span><br><span class="line">DATA/ </span><br><span class="line">ASMCMD&gt; cd data </span><br><span class="line">ASMCMD&gt; ls </span><br><span class="line">ORCL/ </span><br><span class="line">ASMCMD&gt; mkdir arch</span><br></pre></td></tr></table></figure>

<h1>16.dbca建库</h1>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oel1:/home/oracle]$ dbca </span><br><span class="line">Create Database </span><br><span class="line">Select All Nodes </span><br><span class="line">Custom Database </span><br><span class="line">Global Name：orcl </span><br><span class="line">取消EM </span><br><span class="line">Enter Password </span><br><span class="line">Storage mechanism：Choose ASM </span><br><span class="line">Select DATA Group </span><br><span class="line">Use Oracle-Managed Files </span><br><span class="line">Enable Archiving: +DATA/arch </span><br><span class="line">Database Services: </span><br><span class="line">	Add service name:orcl_taf </span><br><span class="line">	Two nodes choose Preferred </span><br><span class="line">	TAF Policy:Basic </span><br><span class="line">#查看资源状态： </span><br><span class="line">[root@oel2:/u01/app/oracle/product/crs]# bin/crs_stat -t -v </span><br><span class="line">Name           Type           R/RA   F/FT   Target    State     Host         </span><br><span class="line">---------------------------------------------------------------------- </span><br><span class="line">ora....SM1.asm application    0/5    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora....L1.lsnr application    0/5    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.gsd   application    0/5    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.ons   application    0/3    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora.oel1.vip   application    0/0    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora....SM2.asm application    0/5    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora....L2.lsnr application    0/5    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.gsd   application    0/5    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.ons   application    0/3    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.oel2.vip   application    0/0    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora.orcl.db    application    0/0    0/1    ONLINE    ONLINE    oel1         </span><br><span class="line">ora....l1.inst application    0/5    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora....l2.inst application    0/5    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">ora...._taf.cs application    0/0    0/1    ONLINE    ONLINE    oel2         </span><br><span class="line">ora....cl1.srv application    0/0    0/0    ONLINE    ONLINE    oel1         </span><br><span class="line">ora....cl2.srv application    0/0    0/0    ONLINE    ONLINE    oel2         </span><br><span class="line">[root@oel1:/u01/app/oracle/product/crs]# bin/srvctl config database -d orcl -a </span><br><span class="line">oel1 orcl1 /u01/app/oracle/product/10.2.0/db_1 </span><br><span class="line">oel2 orcl2 /u01/app/oracle/product/10.2.0/db_1 </span><br><span class="line">DB_NAME: orcl </span><br><span class="line">ORACLE_HOME: /u01/app/oracle/product/10.2.0/db_1 </span><br><span class="line">SPFILE: +DATA/orcl/spfileorcl.ora </span><br><span class="line">DOMAIN: null </span><br><span class="line">DB_ROLE: null </span><br><span class="line">START_OPTIONS: null </span><br><span class="line">POLICY:  AUTOMATIC </span><br><span class="line">ENABLE FLAG: DB ENABLED</span><br></pre></td></tr></table></figure>

<h1>17.集群的一些概念</h1>
 <p>摘自《大话Oracle RAC》</p>

  <p>10g中的hangcheck-timer模块，是Linux提供的一个内核级的IO-Fencing模块，这个模块会监控Linux内核运行状态，如果长时间挂起，此模块会自动重启系统。配置这个模块需要两个参数，hangcheck_tick和hangcheck_margin。前一个参数用于定义多长时间检查一下，缺省值是30秒。第二个参数定义一个延时上限，缺省值为180秒。</p>

 <p> CRS本身还有一个MissCount的参数，可以通过crsctl get css miscount命令查看。Hangcheck-timer根据hangcheck_tick的设置，定时检查内核，只要两次检查的时间间隔小于hangcheck_tick+hangcheck_margin，都会认为内核运行正常，否则，就意味着运行异常，这个模块会重启系统。</p>

  <p>这3个参数会影响RAC重构，假设节点间Heartbeat丢失，Clusterware必须确保在重构时，故障节点确实是Dead状态。如果仅仅因为节点负载过高导致心跳丢失，它是不会重启的。因此，MissCount必须大于两个参数的和，这样，节点重构时，其他节点已经被hangcheck-timer模块重启。</p>

  <p>这种机制涉及到集群原理，在大多数集群设计中，都要考虑到几个问题：1.健忘症(Amnesia)，2.脑裂(Split Brain)，3.IO Fencing。</p>

  <p>1的现象表现为集群配置文件存放在各个节点的本地，当集群正常运行时，用户可以在任意节点更改集群配置，同时自动同步到其他节点。但当某个节点正常关闭，在运行的某个节点修改配置文件，所做的修改是会丢失的。</p>

 <p> 2的现象更简单，但却涉及更复杂的原理。在集群中，节点是通过Heartbeat了解彼此健康状况的。如果心跳出现问题，节点间无法正常通讯，每个节点都会认为自己是正常节点，从而导致资源的争抢，同时意味这数据灾难，这就是脑裂。为了防止脑裂现象，任何的集群都会配置一个仲裁投票机制，即配置一个集群锁盘(仲裁盘)。在三个节点的集群中，如果A节点故障，那么B和C作为一个整体得到BC两票，A得到一票，因此A被剔除集群，BC构成一个新的集群。如果在两个节点的集群上，这种情况就无法实现，因此，又引进一个Quorum Disk，这个共享磁盘也代表一票，集群节点发生故障时候，两个节点会同时去抢qdisk的投票，最先达到的请求先被满足，剩下的节点被剔除。</p>

  <p>当脑裂发生时候，仅仅通过投票算法解决谁获取集群控制权是不够的，还要保证被剔除的节点无法对共享磁盘数据进行操作才行。这就是IO Fencing要解决的问题。</p>

  <p>Fence设备有软件和硬件两种。</p>

  <p>硬件Fence：Power Fencing，如果Power loss，该节点就无法IO，此功能需要整合power management功能来完成，例如iLO，IPMI，DRAC，RSA等。</p>

 <p>软件Fence：fibre channel zoning，一般由fibre channel switches来切断host到SAN的路径；SCSI-3 reservations：正常节点使用SCSI Reserve命令锁住存储设备，故障节点发现存储被锁后，知道自己被踢出集群，就要自己进行重启，以恢复到正常状态。</p>

 <p>在Oracle RAC中，使用OCR磁盘来解决健忘症的问题，使用Votedisk来解决脑裂问题。10g RAC中，Linux平台使用hangcheck-timer解决IO Fencing问题(由css服务保证)，UNIX平台则由进程Process Monitor Daemon(oprocd)负责。而在10.2.0.4中，已经在Linux中引进oprocd来取代hangcheck-timer。11gr2中，使用cssdagent来解决IO Fencing的问题。</p>
 
 

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/rac/">#rac</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Installation/">#Installation</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/deinstall-oracle-11g-rac.html">Deinstall Oracle 11g RAC</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/11gr2-scan-dns.html">11gr2 RAC SCAN DNS Configuration</a>
            
        </span>
    </div>
    
</article>




    </div>
</section>
    <footer class="footer footer-padding">
    <div class="container content">
            <div class="column is-narrow has-text-centered is-size-7-mobile">
                &copy;  <a href="/">Kyun Kong&nbsp;</a>
                2013 - 2019
            </div>
    </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>
-->

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
    
    
    
    

    


<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>