<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>nbu lanfree issue - My Notebook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="lanfree in netbackup">



<meta name="keywords" content="nbu,netbackup">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro|Calibri|Ubuntu">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    

    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    My Notebook
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/">Home</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            nbu lanfree issue
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2014-04-28T01:38:08.000Z" itemprop="datePublished">Apr 28 2014</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/nbu/">nbu</a>
        </span>
        
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>客户一个新系统，两台AIX组成HACMP集群，存储挂了一个EMC VNX5500，VNX5300为备份专用，目前挂载在nbu master server上。<br><a id="more"></a><br>要求通过RMAN同时往磁带和磁盘里面写。由于lanfree架构，需要在备份客户端配置san media server，即这两台小机。在NBU备份策略中，如果选取多份备份，media server需为同一台。因此，这种方案无法实现，否则就只能通过lan备份。<br>最后决定同一个实例配置两个policy，一个为磁带lanfree，一个为nbu master server本地磁盘。然后神奇的事情出现了，当第一个policy配置为lanfree时候，其他policy都申请lanfree资源，policy storage明明选择了disk资源，都会备份到磁带。而且其他policy调用子进程时候，显示的是第一个policy的名称。<br>以下截图情况说明：djgisimg为第一个policy，配置的是oracle_unit的磁盘存储。djoracle配置的是lanfree资源，备份到磁带的。<br>oracle_unit为磁盘资源：<br><img src="/images/nbu1.png" alt="nbu1"><br>父进程名称为djoracle，子进程却变成了第一个policy名称：djgisimg。<br><img src="/images/nbu2.png" alt="nbu2"><br>切父进程调用的是lanfree资源，但子进程却使用了oracle_unit资源：<br><img src="/images/nbu3.png" alt="nbu2"><br><img src="/images/nbu4.png" alt="nbu2"><br>通过官方文档，找到一个解决办法，就是在rman中，加入运行时候环境，指定NBU master server及policy。如：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">run &#123;</span><br><span class="line">allocate channel t1 type &apos;SBT_TAPE&apos;;</span><br><span class="line">allocate channel t2 type &apos;SBT_TAPE&apos;;</span><br><span class="line">send &apos;NB_ORA_POLICY=your_policy, NB_ORA_SERV=your_server&apos;;</span><br><span class="line">backup</span><br><span class="line">(database format &apos;bk_%U_%t&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>或者：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">run &#123;</span><br><span class="line">allocate channel t1 type &apos;SBT_TAPE&apos;</span><br><span class="line">parms=&quot;ENV=(NB_ORA_POLICY=your_pol,</span><br><span class="line">NB_ORA_SERV=your_server)&quot;;</span><br><span class="line">allocate channel t2 type &apos;SBT_TAPE&apos;</span><br><span class="line">parms=&quot;ENV=(NB_ORA_POLICY=your_pol,</span><br><span class="line">NB_ORA_SERV=your_server)&quot;;</span><br><span class="line">backup</span><br><span class="line">(database format &apos;bk_%s_%p_%t&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>send</code> 命令或 <code>parms</code> 操作数用于指定在备份或还原过程中要使用的 Netbackup for Oracle 环境变量。<br>Netbackup for Oracle的环境变量有如下参数（部分）：<br><code>NB_ORA_SERV</code>:指定netbackup master server名称。<br><code>NB_ORA_CLIENT</code>:指定Oracle客户端名称。<br><code>NB_ORA_POLICY</code>:指定Oracle备份时所用到的备份策略。<br><code>NB_ORA_SCHED</code>:指定Oracle要用到的“应用程序备份”日程表的名称。<br>而导致上述情况出现，是跟NBU中oracle备份策略自动产生的default-application-backup有关。按照官网的说法，指定<code>NB_ORA_SCHED</code>不走default-application-backup也可以达到目的，这种方法尚未测试。<br>在网上找了许多文档，也没看到官方对这个default-application-backup有一个明确的说法。个人理解，它是允许用户在客户端通过其他工具对master server发起作业，如Oracle中的RMAN工具。<br>此外，在NBU7.5自带的Windows脚本中，好像有点问题，执行的时候一闪而过，并没有执行备份。后面找了一个5.x的脚本，顺利通过。<br>附上修改后的NBU for Linux/UNIX脚本及for Windows脚本：<br>Linux/UNIX:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"># $Header: hot_database_backup.sh,v 1.3 2010/08/04 17:56:02 $</span><br><span class="line">#</span><br><span class="line">#bcpyrght</span><br><span class="line">#***************************************************************************</span><br><span class="line">#* $VRTScprght: Copyright 1993 - 2012 Symantec Corporation, All Rights Reserved $ *</span><br><span class="line">#***************************************************************************</span><br><span class="line">#ecpyrght</span><br><span class="line">#</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line">#                       hot_database_backup.sh</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line">#  This script uses Recovery Manager to take a hot (inconsistent) database</span><br><span class="line">#  backup. A hot backup is inconsistent because portions of the database are</span><br><span class="line">#  being modified and written to the disk while the backup is progressing.</span><br><span class="line">#  You must run your database in ARCHIVELOG mode to make hot backups. It is</span><br><span class="line">#  assumed that this script will be executed by user root. In order for RMAN</span><br><span class="line">#  to work properly we switch user (su -) to the oracle dba account before</span><br><span class="line">#  execution. If this script runs under a user account that has Oracle dba</span><br><span class="line">#  privilege, it will be executed using this user&apos;s account.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Determine the user which is executing this script.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">CUSER=`id |cut -d&quot;(&quot; -f2 | cut -d &quot;)&quot; -f1`</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Put output in &lt;this file name&gt;.out. Change as desired.</span><br><span class="line"># Note: output directory requires write permission.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">RMAN_LOG_FILE=$&#123;0&#125;_`date +%y%m%d`.out</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># You may want to delete the output file so that backup information does</span><br><span class="line"># not accumulate.  If not, delete the following lines.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">if [ -f &quot;$RMAN_LOG_FILE&quot; ]</span><br><span class="line">then</span><br><span class="line">        rm -f &quot;$RMAN_LOG_FILE&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># -----------------------------------------------------------------</span><br><span class="line"># Initialize the log file.</span><br><span class="line"># -----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">echo &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">chmod 666 $RMAN_LOG_FILE</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Log the start of this script.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">echo Script $0 &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo ==== started on `date` ==== &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Replace /db/oracle/product/ora102, below, with the Oracle home path.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">ORACLE_HOME=/u01/product/11.2.0/db_1</span><br><span class="line">export ORACLE_HOME</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Replace ora102, below, with the Oracle SID of the target database.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">ORACLE_SID=your_sid</span><br><span class="line">export ORACLE_SID</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Replace ora102, below, with the Oracle DBA user id (account).</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">ORACLE_USER=oracle</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Set the target connect string.</span><br><span class="line"># Replace &quot;sys/manager&quot;, below, with the target connect string.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">TARGET_CONNECT_STR=/</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Set the Oracle Recovery Manager name.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">RMAN=$ORACLE_HOME/bin/rman</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Print out the value of the variables set by this script.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">echo &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;RMAN: $RMAN&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;ORACLE_SID: $ORACLE_SID&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;ORACLE_USER: $ORACLE_USER&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;ORACLE_HOME: $ORACLE_HOME&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Print out the value of the variables set by bphdb.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">echo  &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;NB_ORA_FULL: $NB_ORA_FULL&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;NB_ORA_INCR: $NB_ORA_INCR&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;NB_ORA_CINC: $NB_ORA_CINC&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;NB_ORA_SERV: $NB_ORA_SERV&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo   &quot;NB_ORA_POLICY: $NB_ORA_POLICY&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># NOTE: This script assumes that the database is properly opened. If desired,</span><br><span class="line"># this would be the place to verify that.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">echo &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># If this script is executed from a NetBackup schedule, NetBackup</span><br><span class="line"># sets an NB_ORA environment variable based on the schedule type.</span><br><span class="line"># The NB_ORA variable is then used to dynamically set BACKUP_TYPE</span><br><span class="line"># For example, when:</span><br><span class="line">#     schedule type is                BACKUP_TYPE is</span><br><span class="line">#     ----------------                --------------</span><br><span class="line"># Automatic Full                     INCREMENTAL LEVEL=0</span><br><span class="line"># Automatic Differential Incremental INCREMENTAL LEVEL=1</span><br><span class="line"># Automatic Cumulative Incremental   INCREMENTAL LEVEL=1 CUMULATIVE</span><br><span class="line">#</span><br><span class="line"># For user initiated backups, BACKUP_TYPE defaults to incremental</span><br><span class="line"># level 0 (full).  To change the default for a user initiated</span><br><span class="line"># backup to incremental or incremental cumulative, uncomment</span><br><span class="line"># one of the following two lines.</span><br><span class="line"># BACKUP_TYPE=&quot;INCREMENTAL LEVEL=1&quot;</span><br><span class="line"># BACKUP_TYPE=&quot;INCREMENTAL LEVEL=1 CUMULATIVE&quot;</span><br><span class="line">#</span><br><span class="line"># Note that we use incremental level 0 to specify full backups.</span><br><span class="line"># That is because, although they are identical in content, only</span><br><span class="line"># the incremental level 0 backup can have incremental backups of</span><br><span class="line"># level &gt; 0 applied to it.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">if [ &quot;$NB_ORA_FULL&quot; = &quot;1&quot; ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;Full backup requested&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">        BACKUP_TYPE=&quot;INCREMENTAL LEVEL=0&quot;</span><br><span class="line"></span><br><span class="line">elif [ &quot;$NB_ORA_INCR&quot; = &quot;1&quot; ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;Differential incremental backup requested&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">        BACKUP_TYPE=&quot;INCREMENTAL LEVEL=1&quot;</span><br><span class="line"></span><br><span class="line">elif [ &quot;$NB_ORA_CINC&quot; = &quot;1&quot; ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;Cumulative incremental backup requested&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">        BACKUP_TYPE=&quot;INCREMENTAL LEVEL=1 CUMULATIVE&quot;</span><br><span class="line"></span><br><span class="line">elif [ &quot;$BACKUP_TYPE&quot; = &quot;&quot; ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;Default - Full backup requested&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">        BACKUP_TYPE=&quot;INCREMENTAL LEVEL=0&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Call Recovery Manager to initiate the backup. This example does not use a</span><br><span class="line"># Recovery Catalog. If you choose to use one, replace the option &apos;nocatalog&apos;</span><br><span class="line"># from the rman command line below with the</span><br><span class="line"># &apos;catalog &lt;userid&gt;/&lt;passwd&gt;@&lt;net service name&gt;&apos; statement.</span><br><span class="line">#</span><br><span class="line"># Note: Any environment variables needed at run time by RMAN</span><br><span class="line">#       must be set and exported within the switch user (su) command.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line">#  Backs up the whole database.  This backup is part of the incremental</span><br><span class="line">#  strategy (this means it can have incremental backups of levels &gt; 0</span><br><span class="line">#  applied to it).</span><br><span class="line">#</span><br><span class="line">#  We do not need to explicitly request the control file to be included</span><br><span class="line">#  in this backup, as it is automatically included each time file 1 of</span><br><span class="line">#  the system tablespace is backed up (the inference: as it is a whole</span><br><span class="line">#  database backup, file 1 of the system tablespace will be backed up,</span><br><span class="line">#  hence the controlfile will also be included automatically).</span><br><span class="line">#</span><br><span class="line">#  Typically, a level 0 backup would be done at least once a week.</span><br><span class="line">#</span><br><span class="line">#  The scenario assumes:</span><br><span class="line">#     o you are backing your database up to two tape drives</span><br><span class="line">#     o you want each backup set to include a maximum of 5 files</span><br><span class="line">#     o you wish to include offline datafiles, and read-only tablespaces,</span><br><span class="line">#       in the backup</span><br><span class="line">#     o you want the backup to continue if any files are inaccessible.</span><br><span class="line">#     o you are not using a Recovery Catalog</span><br><span class="line">#     o you are explicitly backing up the control file.  Since you are</span><br><span class="line">#       specifying nocatalog, the controlfile backup that occurs</span><br><span class="line">#       automatically as the result of backing up the system file is</span><br><span class="line">#       not sufficient; it will not contain records for the backup that</span><br><span class="line">#       is currently in progress.</span><br><span class="line">#     o you want to archive the current log, back up all the</span><br><span class="line">#       archive logs using two channels, putting a maximum of 20 logs</span><br><span class="line">#       in a backup set, and deleting them once the backup is complete.</span><br><span class="line">#</span><br><span class="line">#  Note that the format string is constructed to guarantee uniqueness and</span><br><span class="line">#  to enhance NetBackup for Oracle backup and restore performance.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">#  NOTE WHEN USING NET SERVICE NAME: When connecting to a database</span><br><span class="line">#  using a net service name, you must use a send command or a parms operand to</span><br><span class="line">#  specify environment variables.  In other words, when accessing a database</span><br><span class="line">#  through a listener, the environment variables set at the system level are not</span><br><span class="line">#  visible when RMAN is running.  For more information on the environment</span><br><span class="line">#  variables, please refer to the NetBackup for Oracle Admin. Guide.</span><br><span class="line">#</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">CMD_STR=&quot;</span><br><span class="line">ORACLE_HOME=$ORACLE_HOME</span><br><span class="line">export ORACLE_HOME</span><br><span class="line">ORACLE_SID=$ORACLE_SID</span><br><span class="line">export ORACLE_SID</span><br><span class="line">$RMAN target $TARGET_CONNECT_STR nocatalog msglog $RMAN_LOG_FILE append &lt;&lt; EOF</span><br><span class="line">RUN &#123;</span><br><span class="line">ALLOCATE CHANNEL ch00 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">ALLOCATE CHANNEL ch01 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">send &apos;NB_ORA_POLICY=your_policy, NB_ORA_SERV=your_server’;</span><br><span class="line">BACKUP</span><br><span class="line">    $BACKUP_TYPE</span><br><span class="line">    SKIP INACCESSIBLE</span><br><span class="line">    TAG hot_db_bk_level0</span><br><span class="line">    FILESPERSET 5</span><br><span class="line">    # recommended format</span><br><span class="line">    FORMAT &apos;bk_%s_%p_%t&apos;</span><br><span class="line">    DATABASE;</span><br><span class="line">    sql &apos;alter system archive log current&apos;;</span><br><span class="line">RELEASE CHANNEL ch00;</span><br><span class="line">RELEASE CHANNEL ch01;</span><br><span class="line"># backup all archive logs</span><br><span class="line">ALLOCATE CHANNEL ch00 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">ALLOCATE CHANNEL ch01 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">BACKUP</span><br><span class="line">   filesperset 20</span><br><span class="line">   FORMAT &apos;al_%s_%p_%t&apos;</span><br><span class="line">   ARCHIVELOG ALL DELETE INPUT;</span><br><span class="line">RELEASE CHANNEL ch00;</span><br><span class="line">RELEASE CHANNEL ch01;</span><br><span class="line">#</span><br><span class="line"># Note: During the process of backing up the database, RMAN also backs up the</span><br><span class="line"># control file.  This version of the control file does not contain the</span><br><span class="line"># information about the current backup because &quot;nocatalog&quot; has been specified.</span><br><span class="line"># To include the information about the current backup, the control file should</span><br><span class="line"># be backed up as the last step of the RMAN section.  This step would not be</span><br><span class="line"># necessary if we were using a recovery catalog or auto control file backups.</span><br><span class="line">#</span><br><span class="line">ALLOCATE CHANNEL ch00 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">BACKUP</span><br><span class="line">    # recommended format</span><br><span class="line">    FORMAT &apos;cntrl_%s_%p_%t&apos;</span><br><span class="line">    CURRENT CONTROLFILE;</span><br><span class="line">RELEASE CHANNEL ch00;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">&quot;</span><br><span class="line"># Initiate the command string</span><br><span class="line"></span><br><span class="line">if [ &quot;$CUSER&quot; = &quot;root&quot; ]</span><br><span class="line">then</span><br><span class="line">    su - $ORACLE_USER -c &quot;$CMD_STR&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">    RSTAT=$?</span><br><span class="line">else</span><br><span class="line">    /usr/bin/sh -c &quot;$CMD_STR&quot; &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">    RSTAT=$?</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"># Log the completion of this script.</span><br><span class="line"># ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">if [ &quot;$RSTAT&quot; = &quot;0&quot; ]</span><br><span class="line">then</span><br><span class="line">    LOGMSG=&quot;ended successfully&quot;</span><br><span class="line">else</span><br><span class="line">    LOGMSG=&quot;ended in error&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo Script $0 &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo ==== $LOGMSG on `date` ==== &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line">echo &gt;&gt; $RMAN_LOG_FILE</span><br><span class="line"></span><br><span class="line">exit $RSTAT</span><br></pre></td></tr></table></figure></p>
<p>Windows NBU5.x:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line">@REM $Header: hot_database_backup.cmd,v 1.3 from QaSanil 2005/11/28 19:01:53 $</span><br><span class="line"></span><br><span class="line">@REM bcpyrght</span><br><span class="line">@REM ***************************************************************************</span><br><span class="line">@REM * $VRTScprght: Copyright 1993 - 2009 Symantec Corporation, All Rights Reserved $ *</span><br><span class="line">@REM ***************************************************************************</span><br><span class="line">@REM ecpyrght</span><br><span class="line">@REM</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM                          hot_database_backup.cmd</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM This script uses Recovery Manager to take a hot (inconsistent) database</span><br><span class="line">@REM backup. A hot backup is inconsistent because portions of the database are</span><br><span class="line">@REM being modified and written to the disk while the backup is progressing.</span><br><span class="line">@REM You must run your database in ARCHIVELOG mode to make hot backups.</span><br><span class="line">@REM</span><br><span class="line">@REM NOTE information for running proxy backups has been included.  These</span><br><span class="line">@REM information sections begin with a comment line of PROXY</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@setlocal ENABLEEXTENSIONS</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM No need to echo the commands.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Put output in the same filename, different extension.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@set RMAN_LOG_FILE=&quot;%~dpn0.out&quot;</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM You may want to delete the output file so that backup information does</span><br><span class="line">@REM not accumulate.  If not, delete the following command.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@if exist %RMAN_LOG_FILE% del %RMAN_LOG_FILE%</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Replace H:\oracle\ora81, below, with the Oracle home path.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@set ORACLE_HOME=D:\oracle\product\10.2.0\db_1</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Replace ora81, below, with the Oracle SID.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@set ORACLE_SID=your-sid</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Replace sys/manager, below, with the target connect string.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@set TARGET_CONNECT_STR=/</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Set the Oracle Recovery Manager.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@set RMAN=%ORACLE_HOME%\bin\rman.exe</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM PROXY</span><br><span class="line">@REM For a PROXY backup, uncomment the line below and replace the value.</span><br><span class="line">@REM</span><br><span class="line">@REM       NB_ORA_PC_STREAMS - specifies the number of parallel backup streams</span><br><span class="line">@REM                           to be started.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM @set NB_ORA_PC_STREAMS=3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Log the start of this scripts.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@for /F &quot;tokens=1*&quot; %%p in (&apos;date /T&apos;) do @set DATE=%%p %%q</span><br><span class="line">@for /F %%p in (&apos;time /T&apos;) do @set DATE=%DATE% %%p</span><br><span class="line"></span><br><span class="line">@echo ==== started on %DATE% ==== &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo Script name: %0 &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Several RMAN commands use time parameters that require NLS_LANG and</span><br><span class="line">@REM NLS_DATE_FORMAT to be set. This example uses the standard date format.</span><br><span class="line">@REM Replace below with the desired language values.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@set NLS_LANG=american</span><br><span class="line">@set NLS_DATE_FORMAT=YYYY-MM-DD:hh24:mi:ss</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Print out environment variables set in this script.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@echo #                                       &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   RMAN  :  %RMAN%                       &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   NLS_LANG  :  %NLS_LANG%               &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   ORACLE_HOME  :  %ORACLE_HOME%         &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   ORACLE_SID  :  %ORACLE_SID%           &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   NLS_DATE_FORMAT  :  %NLS_DATE_FORMAT% &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   RMAN_LOG_FILE  :  %RMAN_LOG_FILE%     &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM PROXY</span><br><span class="line">@REM For a PROXY backup, uncomment the line below.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM @echo   NB_ORA_PC_STREAMS  :  %NB_ORA_PC_STREAMS%     &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Print out environment variables set in bphdb.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@echo   NB_ORA_SERV  :  %NB_ORA_SERV%                     &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   NB_ORA_FULL  :  %NB_ORA_FULL%                     &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   NB_ORA_INCR  :  %NB_ORA_INCR%                     &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   NB_ORA_CINC  :  %NB_ORA_CINC%                     &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo   NB_ORA_CLASS  :  %NB_ORA_CLASS%                   &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM We assume that the database is properly opened. If desired, this would</span><br><span class="line">@REM be the place to verify that.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM If this script is executed from a NetBackup schedule, NetBackup</span><br><span class="line">@REM sets an NB_ORA environment variable based on the schedule type.</span><br><span class="line">@REM For example, when:</span><br><span class="line">@REM     schedule type is                BACKUP_TYPE is</span><br><span class="line">@REM     ----------------                --------------</span><br><span class="line">@REM Automatic Full                      INCREMENTAL LEVEL=0</span><br><span class="line">@REM Automatic Differential Incremental  INCREMENTAL LEVEL=1</span><br><span class="line">@REM Automatic Cumulative Incremental    INCREMENTAL LEVEL=1 CUMULATIVE</span><br><span class="line">@REM</span><br><span class="line">@REM For user initiated backups, BACKUP_TYPE defaults to incremental</span><br><span class="line">@REM level 0 (Full).  To change the default for a user initiated</span><br><span class="line">@REM backup to incremental or incrementatl cumulative, uncomment</span><br><span class="line">@REM one of the following two lines.</span><br><span class="line">@REM @set BACKUP_TYPE=&quot;INCREMENTAL LEVEL=1&quot;</span><br><span class="line">@REM @set BACKUP_TYPE=&quot;INCREMENTAL LEVEL=1 CUMULATIVE&quot;</span><br><span class="line">@REM</span><br><span class="line">@REM Note that we use incremental level 0 to specify full backups.</span><br><span class="line">@REM That is because, although they are identical in content, only</span><br><span class="line">@REM the incremental level 0 backup can have incremental backups of</span><br><span class="line">@REM level &gt; 0 applied to it.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM What kind of backup will we perform.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@if &quot;%NB_ORA_FULL%&quot; EQU &quot;1&quot; @set BACKUP_TYPE=INCREMENTAL Level=0</span><br><span class="line">@if &quot;%NB_ORA_INCR%&quot; EQU &quot;1&quot; @set BACKUP_TYPE=INCREMENTAL Level=1</span><br><span class="line">@if &quot;%NB_ORA_CINC%&quot; EQU &quot;1&quot; @set BACKUP_TYPE=INCREMENTAL Level=1 CUMULATIVE</span><br><span class="line">@if NOT DEFINED BACKUP_TYPE @set BACKUP_TYPE=INCREMENTAL Level=0</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Call Recovery Manager to initiate the backup. This example does not use a</span><br><span class="line">@REM Recovery Catalog. If you choose to use one, remove the option, nocatalog,</span><br><span class="line">@REM from the rman command line below and add a</span><br><span class="line">@REM &apos;rcvcat &lt;userid&gt;/&lt;passwd&gt;@&lt;tns alias&gt;&apos; statement.</span><br><span class="line">@REM</span><br><span class="line">@REM  NOTE WHEN USING TNS ALIAS: When connecting to a database</span><br><span class="line">@REM  using a TNS alias, you must use a send command or a parms operand to</span><br><span class="line">@REM  specify environment variables.  In other words, when accessing a database</span><br><span class="line">@REM  through a listener, the environment variables set at the system level are not</span><br><span class="line">@REM  visible when RMAN is running.  For more information on the environment</span><br><span class="line">@REM  variables, please refer to the NetBackup for Oracle Admin. Guide.</span><br><span class="line">@REM</span><br><span class="line">@REM If you are getting an error that the input line is too long, you will need</span><br><span class="line">@REM to put the RMAN run block in a separate file.  Then use the &quot;cmdfile&quot;</span><br><span class="line">@REM option of RMAN.  For more information on the &quot;cmdfile&quot; options please</span><br><span class="line">@REM refer to the RMAN documentation.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM PROXY</span><br><span class="line">@REM For a PROXY backup, you must use a send command to specify</span><br><span class="line">@REM the NB_ORA_PC_STREAMS environment variable. For example,</span><br><span class="line">@REM echo ALLOCATE CHANNEL ch01 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">@REM echo SEND &apos;NB_ORA_PC_STREAMS=%%NB_ORA_PC_STREAMS%%&apos;;</span><br><span class="line">@REM</span><br><span class="line">@REM %BACKUP_TYPE% must also be removed and replaced with the PROXY parameter</span><br><span class="line">@REM in the RMAN section associated with the data files.  For example,</span><br><span class="line">@REM echo BACKUP</span><br><span class="line">@REM echo       PROXY</span><br><span class="line">@REM echo       FORMAT &apos;bk_u%%u_s%%s_p%%p_t%%t&apos;</span><br><span class="line">@REM echo       DATABASE;</span><br><span class="line">@REM            .</span><br><span class="line">@REM            .</span><br><span class="line">@REM  Note that the controlfiles and archivelogs are not backed up using proxy</span><br><span class="line">@REM  copy method. Rman will initiate non-proxy copy sessions to backup the</span><br><span class="line">@REM  controlfile and archivelogs.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@(</span><br><span class="line">echo RUN &#123;</span><br><span class="line">echo ALLOCATE CHANNEL ch00 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">echo ALLOCATE CHANNEL ch01 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">echo send &apos;NB_ORA_SERV=your_bk_server,NB_ORA_POLICY=your_policy&apos;;</span><br><span class="line">echo BACKUP</span><br><span class="line">echo       %BACKUP_TYPE%</span><br><span class="line">echo       FORMAT &apos;bk_u%%u_s%%s_p%%p_t%%t&apos;</span><br><span class="line">echo       DATABASE;</span><br><span class="line">echo sql &apos;alter system archive log current&apos;;</span><br><span class="line">echo RELEASE CHANNEL ch00;</span><br><span class="line">echo RELEASE CHANNEL ch01;</span><br><span class="line">echo # Backup all archive logs</span><br><span class="line">echo ALLOCATE CHANNEL ch00 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">echo BACKUP</span><br><span class="line">echo       FILESPERSET 20</span><br><span class="line">echo       FORMAT &apos;arch-s%%s-p%%p&apos;</span><br><span class="line">echo       ARCHIVELOG ALL;</span><br><span class="line">echo RELEASE CHANNEL ch00;</span><br><span class="line">echo ALLOCATE CHANNEL ch00 TYPE &apos;SBT_TAPE&apos;;</span><br><span class="line">echo BACKUP</span><br><span class="line">echo       FORMAT &apos;cntrl_%s_%p_%t&apos;</span><br><span class="line">echo       CURRENT CONTROLFILE;</span><br><span class="line">echo RELEASE CHANNEL ch00;</span><br><span class="line">echo &#125;</span><br><span class="line">) | %RMAN% target %TARGET_CONNECT_STR% nocatalog msglog &apos;%RMAN_LOG_FILE%&apos; append</span><br><span class="line"></span><br><span class="line">@set ERRLEVEL=%ERRORLEVEL%</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM NetBackup (bphdb) stores the name of a file in an environment variable,</span><br><span class="line">@REM called STATUS_FILE. This file is used by an automatic schedule to</span><br><span class="line">@REM communicate status information with NetBackup&apos;s job monitor. It is up to</span><br><span class="line">@REM the script to write a 0 (passed) or 1 (failure) to the status file.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@if %ERRLEVEL% NEQ 0 @goto err</span><br><span class="line"></span><br><span class="line">@set LOGMSG=ended successfully</span><br><span class="line">@if &quot;%STATUS_FILE%&quot; EQU &quot;&quot; goto end</span><br><span class="line">@echo 0 &gt; &quot;%STATUS_FILE%&quot;</span><br><span class="line">@goto end</span><br><span class="line"></span><br><span class="line">:err</span><br><span class="line">@set LOGMSG=ended in error</span><br><span class="line">@if &quot;%STATUS_FILE%&quot; EQU &quot;&quot; @goto end</span><br><span class="line">@echo 1 &gt; &quot;%STATUS_FILE%&quot;</span><br><span class="line"></span><br><span class="line">:end</span><br><span class="line"></span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line">@REM Log the completion of this script.</span><br><span class="line">@REM ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">@for /F &quot;tokens=1*&quot; %%p in (&apos;date /T&apos;) do @set DATE=%%p %%q</span><br><span class="line">@for /F %%p in (&apos;time /T&apos;) do @set DATE=%DATE% %%p</span><br><span class="line"></span><br><span class="line">@echo #  &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@echo %==== %LOGMSG% on %DATE% ==== &gt;&gt; %RMAN_LOG_FILE%</span><br><span class="line">@endlocal</span><br><span class="line">@REM End of Main Program -----------------------------------------------------</span><br></pre></td></tr></table></figure></p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/nbu/">#nbu</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/em-locale-failed.html">Oracle Enterprise Management failed with locale failed</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/upgrade-10gr2-rac-to-11gr2-rac.html">Upgrade 10gr2 RAC to 11gr2 RAC</a>
            
        </span>
    </div>
    
</article>




    </div>
</section>
    <footer class="footer footer-padding">
    <div class="container content">
            <div class="column is-narrow has-text-centered is-size-7-mobile">
                &copy;  <a href="/">Kyun Kong&nbsp;</a>
                2013 - 2018
            </div>
    </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
    
    
    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>