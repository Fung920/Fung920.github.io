<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>RAC DataGuard配置 - My Notebook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="how to configure physical dataguard in 11gr2 rac,RAC数据库物理DataGuard">



<meta name="keywords" content="rac,dataguard,MAA">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro|Calibri|Ubuntu">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    

    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    My Notebook
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/">Home</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            RAC DataGuard配置
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2014-05-29T16:00:00.000Z" itemprop="datePublished">May 30 2014</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/oracle/">oracle</a>
                    <span id="busuanzi_container_page_pv">
Viewed <span id="busuanzi_value_page_pv"></span> times.
</span>

        </span>
        
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p></p><h3>1.本文目的</h3><br>DataGuard 是 Oracle 数据库的一个功能，能够提供数据库的冗余。冗余是通过创建一个备用（物理复制）数据库实现，备库最好是在不同的地理位置或者在不同的磁盘上。备库通过应用主库上的变化来保持数据同步。备库可以使用重做日志应用同步(物理备库)。物理备库只安装软件，不创建实例。<br><a id="more"></a><br>本文目的在于介绍Oracle 11gr2 RAC快速创建创建单机节点DataGuard的过程。<p></p>
<p></p><h3>2.环境</h3><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">主库：11gr2 RAC+ASM，DB_UNIQUE_NAME: rac11g  </span><br><span class="line">备库：11gr2 Single+ASM/FS，DB_UNIQUE_NAME: stdby  </span><br><span class="line">ORACLE_SID:rac11g  </span><br><span class="line">Primary hostname：fung01，fung02  </span><br><span class="line">Standby hostname：fung03  </span><br><span class="line">Oracle数据库软件版本：  </span><br><span class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.3.0 - 64bit Production</span><br><span class="line">操作系统版本均为OEL 5.8 x64</span><br></pre></td></tr></table></figure><p></p>
<p>DataGuard配置日志接收方式，本文采用LGWR。  </p>
<p></p><h3>3.收集前期信息</h3><br>IP规划<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[grid@fung02:/home/grid]$ cat /etc/hosts</span><br><span class="line"># Do not remove the following line, or various programs</span><br><span class="line"># that require network functionality will fail.</span><br><span class="line">127.0.0.1               fung01 localhost.localdomain localhost</span><br><span class="line"></span><br><span class="line">#public IP </span><br><span class="line">192.168.192.101         fung01 </span><br><span class="line">192.168.192.102         fung02</span><br><span class="line"></span><br><span class="line">#priv </span><br><span class="line">10.10.10.101            fung01-priv </span><br><span class="line">10.10.10.102            fung02-priv</span><br><span class="line"></span><br><span class="line">#Virtual IP </span><br><span class="line">192.168.192.103         fung01-vip </span><br><span class="line">192.168.192.104			fung02-vip</span><br><span class="line"></span><br><span class="line">#SCAN </span><br><span class="line">192.168.192.105         rac11g-scan</span><br><span class="line"></span><br><span class="line">#dataguard</span><br><span class="line">192.168.192.107         fung03</span><br></pre></td></tr></table></figure><p></p>
<p>主库日志文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt;  select group#, thread#, bytes, blocksize, members from v$log;</span><br><span class="line"></span><br><span class="line">    GROUP#    THREAD#      BYTES  BLOCKSIZE    MEMBERS</span><br><span class="line">---------- ---------- ---------- ---------- ----------</span><br><span class="line">         1          1   52428800        512          1</span><br><span class="line">         2          1   52428800        512          1</span><br><span class="line">         3          2   52428800        512          1</span><br><span class="line">         4          2   52428800        512          1</span><br><span class="line">SQL&gt; set linesize 200</span><br><span class="line">SQL&gt; col member for a50</span><br><span class="line">SQL&gt; select member, group# from v$logfile order by 2;</span><br><span class="line"></span><br><span class="line">MEMBER                                                 GROUP#</span><br><span class="line">-------------------------------------------------- ----------</span><br><span class="line">+DATA/rac11g/onlinelog/group_1.257.848925419                1</span><br><span class="line">+DATA/rac11g/onlinelog/group_2.258.848925421                2</span><br><span class="line">+DATA/rac11g/onlinelog/group_3.265.848926807                3</span><br><span class="line">+DATA/rac11g/onlinelog/group_4.266.848926809                4</span><br></pre></td></tr></table></figure></p>
<p>主库数据文件信息<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; col name for a80</span><br><span class="line">SQL&gt; select name from v$datafile;</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">+DATA/rac11g/datafile/system.259.848925423</span><br><span class="line">+DATA/rac11g/datafile/sysaux.260.848925443</span><br><span class="line">+DATA/rac11g/datafile/undotbs1.261.848925457</span><br><span class="line">+DATA/rac11g/datafile/undotbs2.263.848925475</span><br><span class="line">+DATA/rac11g/datafile/users.264.848925483</span><br></pre></td></tr></table></figure></p>
<p>服务名及其他<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; show parameter name</span><br><span class="line"></span><br><span class="line">NAME                                 TYPE                   VALUE</span><br><span class="line">------------------------------------ ---------------------- ------------------------------</span><br><span class="line">cell_offloadgroup_name               string</span><br><span class="line">db_file_name_convert                 string</span><br><span class="line">db_name                              string                 rac11g</span><br><span class="line">db_unique_name                       string                 rac11g</span><br><span class="line">global_names                         boolean                FALSE</span><br><span class="line">instance_name                        string                 rac11g1</span><br><span class="line">lock_name_space                      string</span><br><span class="line">log_file_name_convert                string</span><br><span class="line">processor_group_name                 string</span><br><span class="line">service_names                        string                 rac11g</span><br></pre></td></tr></table></figure></p>
<h3 id="4-配置DataGuard"><a href="#4-配置DataGuard" class="headerlink" title="4.配置DataGuard"></a>4.配置DataGuard</h3><h4 id="4-1修改logging模式"><a href="#4-1修改logging模式" class="headerlink" title="4.1修改logging模式"></a>4.1修改logging模式</h4><p>备库要成为主库完全相同的复本，它必须接收来自主库的重做日志，Oracle数据库中，用户可以指定某些操作不产生日志(NOLOGGING子句)，对于备库来说，这是个很大的问题，因此，我们必须确认用户无法指示数据库不产生重做日志，即启用数据库的强制日志功能。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter database force logging;</span><br><span class="line"></span><br><span class="line">Database altered.</span><br><span class="line"></span><br><span class="line">SQL&gt;  select name, force_logging from v$database;</span><br><span class="line"></span><br><span class="line">NAME                                                                             FORCE_</span><br><span class="line">-------------------------------------------------------------------------------- ------</span><br><span class="line">RAC11G                                                                           YES</span><br></pre></td></tr></table></figure></p>
<h4 id="4-2为备库创建密码文件"><a href="#4-2为备库创建密码文件" class="headerlink" title="4.2为备库创建密码文件"></a>4.2为备库创建密码文件</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung03:/home/oracle]$ orapwd file=$ORACLE_HOME/dbs/orapw$ORACLE_SID \</span><br><span class="line">password=oracle entries=5 force=y ignorecase=y</span><br><span class="line">[oracle@fung03:/home/oracle]$ cd -</span><br><span class="line">/u01/app/oracle/product/11gr2/dbs</span><br><span class="line">[oracle@fung03:/u01/app/oracle/product/11gr2/dbs]$ ls -lt</span><br><span class="line">total 20</span><br><span class="line">-rw-r----- 1 oracle oinstall 2048 May 30 15:15 orapwrac11g</span><br><span class="line">-rw-rw---- 1 oracle oinstall 1544 May 30 15:05 hc_rac11g.dat</span><br><span class="line">-rw-r--r-- 1 oracle oinstall 1229 May 30 15:05 initrac11g.ora</span><br><span class="line">-rw-r----- 1 oracle oinstall 3584 May 30 15:04 spfilerac11g.ora</span><br><span class="line">-rw-r--r-- 1 oracle oinstall 2851 May 15  2009 init.ora</span><br></pre></td></tr></table></figure>
<h4 id="4-3更新网络配置文件"><a href="#4-3更新网络配置文件" class="headerlink" title="4.3更新网络配置文件"></a>4.3更新网络配置文件</h4><p>在创建备库之前，要确认两台服务器的数据库之间能通信，首先要配置主备库监听，使用RMAN的<code>duplicate</code>命令创建备库，备库必须首先处于NOMOUNT状态。在NOMOUNT状态下，数据库实例不会自动注册监听，必须配置静态监听。将以下信息添加进主库及备库的tnsnames.ora文档。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">RAC11G =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS = (PROTOCOL = TCP)(HOST = rac11g-scan)(PORT = 1521))</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVER = DEDICATED)</span><br><span class="line">      (SERVICE_NAME = rac11g)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">STDBY =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS = (PROTOCOL = TCP)(HOST = fung03)(PORT = 1521))</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVER = DEDICATED)</span><br><span class="line">      (SERVICE_NAME = rac11g)</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure></p>
<p>添加备库listener信息，静态注册备库listener.ora<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung03:/u01/app/oracle/product/11gr2/network/admin]$ cat listener.ora </span><br><span class="line">SID_LIST_LISTENER =</span><br><span class="line">  (SID_LIST =</span><br><span class="line">    (SID_DESC =</span><br><span class="line">       (GLOBAL_NAME= stdby)</span><br><span class="line">       (ORACLE_HOME = /u01/app/oracle/product/11gr2)</span><br><span class="line">       (SID_NAME = rac11g)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">LISTENER =</span><br><span class="line">  (DESCRIPTION_LIST =</span><br><span class="line">    (DESCRIPTION =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = fung03)(PORT = 1521))</span><br><span class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC0))</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure></p>
<p>同时启动备库监听<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung03:/u01/app/oracle/product/11gr2/network/admin]$ lsnrctl start</span><br><span class="line"></span><br><span class="line">LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 30-MAY-2014 15:21:42</span><br><span class="line"></span><br><span class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Starting /u01/app/oracle/product/11gr2//bin/tnslsnr: please wait...</span><br><span class="line"></span><br><span class="line">TNSLSNR for Linux: Version 11.2.0.4.0 - Production</span><br><span class="line">System parameter file is /u01/app/oracle/product/11gr2/network/admin/listener.ora</span><br><span class="line">Log messages written to /u01/app/oracle/diag/tnslsnr/fung03/listener/alert/log.xml</span><br><span class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=fung03)(PORT=1521)))</span><br><span class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC0)))</span><br><span class="line"></span><br><span class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=fung03)(PORT=1521)))</span><br><span class="line">STATUS of the LISTENER</span><br><span class="line">------------------------</span><br><span class="line">Alias                     LISTENER</span><br><span class="line">Version                   TNSLSNR for Linux: Version 11.2.0.4.0 - Production</span><br><span class="line">Start Date                30-MAY-2014 15:21:44</span><br><span class="line">Uptime                    0 days 0 hr. 0 min. 1 sec</span><br><span class="line">Trace Level               off</span><br><span class="line">Security                  ON: Local OS Authentication</span><br><span class="line">SNMP                      OFF</span><br><span class="line">Listener Parameter File   /u01/app/oracle/product/11gr2/network/admin/listener.ora</span><br><span class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/fung03/listener/alert/log.xml</span><br><span class="line">Listening Endpoints Summary...</span><br><span class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=fung03)(PORT=1521)))</span><br><span class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC0)))</span><br><span class="line">Services Summary...</span><br><span class="line">Service &quot;rac11g&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;rac11g&quot;, status UNKNOWN, has 1 handler(s) for this service...</span><br><span class="line">The command completed successfully</span><br><span class="line">[oracle@fung03:/u01/app/oracle/product/11gr2/network/admin]$ lsnrctl service</span><br><span class="line"></span><br><span class="line">LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 30-MAY-2014 15:21:49</span><br><span class="line"></span><br><span class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=fung03)(PORT=1521)))</span><br><span class="line">Services Summary...</span><br><span class="line">Service &quot;rac11g&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;rac11g&quot;, status UNKNOWN, has 1 handler(s) for this service...</span><br><span class="line">    Handler(s):</span><br><span class="line">      &quot;DEDICATED&quot; established:0 refused:0</span><br><span class="line">         LOCAL SERVER</span><br><span class="line">The command completed successfully</span><br></pre></td></tr></table></figure></p>
<h4 id="4-4创建跟pfile中相同的文件目录"><a href="#4-4创建跟pfile中相同的文件目录" class="headerlink" title="4.4创建跟pfile中相同的文件目录"></a>4.4创建跟pfile中相同的文件目录</h4><p>需要注意的是，这些路径要跟pfile中相对应。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung03:/home/oracle]$ mkdir -p /u01/app/oracle/diag/rdbms/rac11g/rac11g/trace</span><br><span class="line">[oracle@fung03:/home/oracle]$ mkdir -p /u01/app/oracle/diag/rdbms/rac11g/rac11g/cdump</span><br><span class="line">[oracle@fung03:/home/oracle]$ mkdir -p /u01/app/oracle/admin/rac11g/adump</span><br></pre></td></tr></table></figure></p>
<h3 id="5-创建DataGuard"><a href="#5-创建DataGuard" class="headerlink" title="5.创建DataGuard"></a>5.创建DataGuard</h3><h4 id="5-1配置主库DataGuard参数"><a href="#5-1配置主库DataGuard参数" class="headerlink" title="5.1配置主库DataGuard参数"></a>5.1配置主库DataGuard参数</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#让主库知道DataGuard配置里的另一个库的名字</span><br><span class="line">SQL&gt; alter system set log_archive_config=&apos;dg_config=(rac11g,stdby)&apos; scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br><span class="line">#配置主库本地归档路径</span><br><span class="line">SQL&gt; alter system set log_archive_dest_1=&apos;location=+DATA/arch valid_for=(all_logfiles,all_roles) db_unique_name=rac11g&apos; scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br><span class="line"></span><br><span class="line">#配置主库远程归档路径</span><br><span class="line">SQL&gt; alter system set log_archive_dest_2=&apos;service=STDBY LGWR ASYNC NOAFFIRM valid_for=(online_logfiles,primary_role) db_unique_name=stdby&apos; scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br><span class="line">以上归档切换时是用lgwr的异步传输方式</span><br></pre></td></tr></table></figure>
<p>对于以上参数的简单说明：<br><code>AFFIRM and NOAFFIRM</code><br>AFFIRM：在写入到standby redo log 后，指定重做传输目标接受重做传输日志。<br>NOAFFIRM：在写入到standby redo log前，重做传输日志可以传输到目的地。<br><code>LOCATION and SERVICE</code><br>LOCATION: 表示归档到本地。<br>SERVICE: 表示归档到远程，跟tnsname.ora文件中的tnsname相同。<br><code>SYNC and ASYNC</code><br>指定使用同步还是异步传输模式。<br><code>VALID_FOR</code><br>指定数据库运行在主还是从数据库的角色。<br>是否online redo log files, standby redo log files 或是他们都将归档到该目的地，这里配置的是不管是online log还是standy log，也不管当前数据库是主库还是备库，都将归档到service=STDBY的远程归档上。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#开启归档路径1和归档路径2</span><br><span class="line">SQL&gt; alter system set log_archive_dest_state_1=&apos;enable&apos; scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br><span class="line"></span><br><span class="line">SQL&gt;  alter system set log_archive_dest_state_2=&apos;enable&apos; scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br><span class="line"></span><br><span class="line">SQL&gt; alter system set log_archive_max_processes=10 scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br></pre></td></tr></table></figure></p>
<p>添加备库自动管理文件功能，即当主库添加或删除数据文件时，这些文件也会在备库添加或删除。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set standby_file_management=&apos;AUTO&apos; scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br></pre></td></tr></table></figure></p>
<p>设置FAL_SERVER参数，此参数指定当日志传输出问题时，备库到哪里去找缺失的归档日志。它用在备库接收的到的重做日志间有gap的时候。这种情况会发生在日志传输出现中断时，如对备库需要维护而主库仍然正常运行，这时候，备库维护期间，没有日志传输过来，gap就出现了，设置了这个参数，备库会主动去寻找那些缺失的日志，并要求主库进行传输。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set fal_server=&apos;stdby&apos; scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br></pre></td></tr></table></figure></p>
<p>至此，主库DataGuard相关参数修改完毕，用以下语句确认是否有误。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; set linesize 500 pages 0</span><br><span class="line">SQL&gt; col value for a120</span><br><span class="line">SQL&gt; col name for a50</span><br><span class="line">SQL&gt; select name, value</span><br><span class="line">  2  from v$parameter</span><br><span class="line">  3  where name in (&apos;db_name&apos;,&apos;db_unique_name&apos;,</span><br><span class="line">  4  &apos;log_archive_config&apos;,</span><br><span class="line">  5  &apos;log_archive_dest_1&apos;,&apos;log_archive_dest_2&apos;,</span><br><span class="line">  6  &apos;log_archive_dest_state_1&apos;,</span><br><span class="line">  7  &apos;log_archive_dest_state_2&apos;,</span><br><span class="line">  8  &apos;remote_login_passwordfile&apos;,</span><br><span class="line">  9  &apos;log_archive_format&apos;,</span><br><span class="line"> 10  &apos;log_archive_max_processes&apos;,</span><br><span class="line"> 11  &apos;fal_server&apos;,&apos;db_file_name_convert&apos;,</span><br><span class="line"> 12  &apos;log_file_name_convert&apos;,</span><br><span class="line"> 13  &apos;standby_file_management&apos;)</span><br><span class="line"> 14  /</span><br><span class="line">db_file_name_convert</span><br><span class="line">log_file_name_convert</span><br><span class="line">log_archive_dest_1                                 location=+DATA/arch valid_for=(all_logfiles,all_roles) db_unique_name=rac11g</span><br><span class="line">log_archive_dest_2                                 service=STDBY LGWR ASYNC NOAFFIRM valid_for=(online_logfiles,primary_role) db_unique_name=stdby</span><br><span class="line">log_archive_dest_state_1                           enable</span><br><span class="line">log_archive_dest_state_2                           enable</span><br><span class="line">fal_server                                         stdby</span><br><span class="line">log_archive_config                                 dg_config=(rac11g,stdby)</span><br><span class="line">log_archive_format                                 %t_%s_%r.arc</span><br><span class="line">log_archive_max_processes                          10</span><br><span class="line">standby_file_management                            AUTO</span><br><span class="line">remote_login_passwordfile                          EXCLUSIVE</span><br><span class="line">db_name                                            rac11g</span><br><span class="line">db_unique_name                                     rac11g</span><br><span class="line"></span><br><span class="line">14 rows selected.</span><br></pre></td></tr></table></figure></p>
<h3 id="5-2主库添加standby-redo-log"><a href="#5-2主库添加standby-redo-log" class="headerlink" title="5.2主库添加standby redo log"></a>5.2主库添加standby redo log</h3><h5 id="添加原则"><a href="#添加原则" class="headerlink" title="添加原则"></a>添加原则</h5><p><li>standby redo log的文件大小与primary 数据库online redo log 文件大小相同</li></p>
<p><li>standby redo log日志文件组的个数依照下面的原则进行计算</li><br>Standby redo log组数公式&gt;=(每个instance日志组个数+1)*instance个数，例如在我的环境中，有两个节点，每个节点有2组redo，所以Standby redo log组数公式&gt;=(2+1)*2  == 6，所以需要创建6组Standby redo log。</p>
<p><li>每一日志组为了安全起见，可以包含多个成员文件</li><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alter database add standby logfile group 5 size 50M;</span><br><span class="line">alter database add standby logfile group 6 size 50M;</span><br><span class="line">alter database add standby logfile group 7 size 50M;</span><br><span class="line">alter database add standby logfile group 8 size 50M;</span><br><span class="line">alter database add standby logfile group 9 size 50M;</span><br><span class="line">alter database add standby logfile group 10 size 50M;</span><br></pre></td></tr></table></figure></p>
<p>查看结果<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; col member for a50</span><br><span class="line">SQL&gt; select member,type from v$logfile;</span><br><span class="line"></span><br><span class="line">MEMBER                                             TYPE</span><br><span class="line">-------------------------------------------------- --------------</span><br><span class="line">+DATA/rac11g/onlinelog/group_1.257.848925419       ONLINE</span><br><span class="line">+DATA/rac11g/onlinelog/group_2.258.848925421       ONLINE</span><br><span class="line">+DATA/rac11g/onlinelog/group_3.265.848926807       ONLINE</span><br><span class="line">+DATA/rac11g/onlinelog/group_4.266.848926809       ONLINE</span><br><span class="line">+DATA/rac11g/onlinelog/group_5.333.849348597       STANDBY</span><br><span class="line">+DATA/rac11g/onlinelog/group_6.334.849348599       STANDBY</span><br><span class="line">+DATA/rac11g/onlinelog/group_7.335.849348601       STANDBY</span><br><span class="line">+DATA/rac11g/onlinelog/group_8.336.849348603       STANDBY</span><br><span class="line">+DATA/rac11g/onlinelog/group_9.337.849348605       STANDBY</span><br><span class="line">+DATA/rac11g/onlinelog/group_10.338.849348607      STANDBY</span><br></pre></td></tr></table></figure></p>
<h3 id="6-编辑备库pfile"><a href="#6-编辑备库pfile" class="headerlink" title="6.编辑备库pfile"></a>6.编辑备库pfile</h3><p>从主库创建pfile，取消RAC相关参数，并且添加以下参数：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*.db_name=&apos;rac11g&apos;</span><br><span class="line">*.db_unique_name=&apos;stdby&apos;</span><br><span class="line">*.standby_file_management=&apos;AUTO&apos;</span><br><span class="line">*.undo_tablespace=&apos;UNDOTBS1&apos;</span><br><span class="line">*.fal_server=&apos;rac11g&apos;</span><br><span class="line">*.log_archive_config=&apos;dg_config=(rac11g,stdby)&apos;</span><br><span class="line">*.log_archive_dest_1=&apos;location=/oradata/arch valid_for=(all_logfiles,all_roles) db_unique_name=stdby&apos;</span><br><span class="line">*.log_archive_dest_2=&apos;service=rac11g LGWR ASYNC NOAFFIRM valid_for=(online_logfiles,primary_role) db_unique_name=rac11g&apos;</span><br><span class="line">*.log_archive_dest_state_1=&apos;enable&apos;</span><br><span class="line">*.log_archive_dest_state_2=&apos;enable&apos;</span><br></pre></td></tr></table></figure></p>
<h3 id="7-利用rman创建Standby"><a href="#7-利用rman创建Standby" class="headerlink" title="7.利用rman创建Standby"></a>7.利用rman创建Standby</h3><p>11g以后，可以利用duplicate active database或者从备份直接创建DataGuard，分别以两种不同方式创建，第一种以duplicate active standby还原至file system，第二种方式采用备份还原至ASM。<br>先将备库启动至nomount模式。</p>
<h4 id="7-1duplicate-active-standby"><a href="#7-1duplicate-active-standby" class="headerlink" title="7.1duplicate active standby"></a>7.1duplicate active standby</h4><p>由ASM还原至文件系统，需要经过set newname参数。同时因为日志文件路径也不同，需要在pfile中添加LOG_FILE_NAME_CONVERT参数进行变换，否则会报错:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RMAN-05535: WARNING: All redo log files were not defined properly.</span><br><span class="line">ORACLE error from auxiliary database: ORA-00344: unable to re-create online log &apos;+data&apos;</span><br><span class="line">ORA-17502: ksfdcre:4 Failed to create file +data</span><br><span class="line">ORA-15001: diskgroup &quot;DATA&quot; does not exist or is not mounted</span><br><span class="line">ORA-15040: diskgroup is incomplete</span><br><span class="line">ORA-15040: diskgroup is incomplete</span><br></pre></td></tr></table></figure></p>
<p>执行复制脚本如下：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung03:/u01/app/oracle/product/11gr2/dbs]$ rman target sys/oracle@rac11g \</span><br><span class="line">auxiliary sys/oracle@stdby msglog=/home/oracle/rac11g_`date &apos;+%Y%m%d%H%M&apos;`.log&lt;&lt;EOF</span><br><span class="line">run&#123;</span><br><span class="line">allocate channel c1 type disk;</span><br><span class="line">allocate auxiliary channel ch1 TYPE disk;</span><br><span class="line">set newname for datafile 1  to &apos;/oradata/rac11g/system01.dbf&apos;;</span><br><span class="line">set newname for datafile 3  to &apos;/oradata/rac11g/undotbs01.dbf&apos;;</span><br><span class="line">set newname for datafile 2  to &apos;/oradata/rac11g/sysaux01.dbf&apos;;</span><br><span class="line">set newname for datafile 5  to &apos;/oradata/rac11g/users01.dbf&apos;;</span><br><span class="line">set newname for datafile 4  to &apos;/oradata/rac11g/undotbs02.dbf&apos;;</span><br><span class="line">set newname for tempfile 1  to &apos;/oradata/rac11g/temp01.dbf&apos;;</span><br><span class="line">DUPLICATE TARGET DATABASE FOR STANDBY FROM ACTIVE DATABASE DORECOVER;</span><br><span class="line">&#125;</span><br><span class="line">exit;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p>11g新特性，增加PARAMETER_VALUE_CONVERT参数，可参见<a href="/duplicate-database-with-rman.html">Duplicate Database With RMAN</a>最后一点。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#For single to single</span><br><span class="line">DUPLICATE TARGET DATABASE FOR STANDBY FROM ACTIVE DATABASE</span><br><span class="line">SPFILE</span><br><span class="line">PARAMETER_VALUE_CONVERT &apos;/oradata/datafile/linora/&apos;,&apos;/dup/&apos;</span><br><span class="line">SET &quot;DB_UNIQUE_NAME&quot;=&quot;stdby&quot;</span><br><span class="line">SET SGA_MAX_SIZE = &apos;250M&apos;</span><br><span class="line">SET SGA_TARGET = &apos;250M&apos;</span><br><span class="line">SET log_archive_dest_1 = &apos;LOCATION=/dup/arch/&apos;</span><br><span class="line">SET LOG_FILE_NAME_CONVERT=&apos;/oradata/datafile/linora/&apos;,&apos;/dup/&apos;</span><br><span class="line">DB_FILE_NAME_CONVERT=&apos;/oradata/datafile/linora/&apos;,&apos;/dup/&apos;;</span><br><span class="line">#For rac to single</span><br><span class="line">DUPLICATE TARGET DATABASE FOR STANDBY FROM ACTIVE DATABASE</span><br><span class="line">SPFILE</span><br><span class="line">PARAMETER_VALUE_CONVERT &apos;rac11g&apos;,&apos;stdby&apos;</span><br><span class="line">SET &quot;DB_UNIQUE_NAME&quot;=&quot;stdby&quot;</span><br><span class="line">SET LOG_FILE_NAME_CONVERT=&apos;rac11g&apos;,&apos;stdby&apos;</span><br><span class="line">SET &quot;CLUSTER_DATABASE&quot;=&quot;FALSE&quot;</span><br><span class="line">SET &quot;FAL_SERVER&quot;=&quot;rac11g&quot;</span><br><span class="line">SET &quot;FAL_CLIENT&quot;=&quot;stdby&quot;</span><br><span class="line">SET &quot;LOG_ARCHIVE_DEST_2&quot;=&quot;service=rac11g LGWR ASYNC NOAFFIRM valid_for=(online_logfiles,primary_role) db_unique_name=rac11g&quot;</span><br><span class="line">SET &quot;LOG_ARCHIVE_DEST_STATE_1&quot;=&quot;enable&quot;</span><br><span class="line">SET &quot;LOG_ARCHIVE_DEST_STATE_2&quot;=&quot;enable&quot;</span><br><span class="line">RESET REMOTE_LISTENER</span><br><span class="line">DB_FILE_NAME_CONVERT=&apos;rac11g&apos;,&apos;stdby&apos;;</span><br></pre></td></tr></table></figure></p>
<h4 id="7-2使用备份创建DataGuard至ASM"><a href="#7-2使用备份创建DataGuard至ASM" class="headerlink" title="7.2使用备份创建DataGuard至ASM"></a>7.2使用备份创建DataGuard至ASM</h4><p>11g ASM管理需要安装GI，然后把磁盘挂载即可。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select name,state,type,total_mb,free_mb</span><br><span class="line">  2  from v$asm_diskgroup; </span><br><span class="line"></span><br><span class="line">NAME                           STATE       TYPE     TOTAL_MB    FREE_MB</span><br><span class="line">------------------------------ ----------- ------ ---------- ----------</span><br><span class="line">DATA                           MOUNTED     NORMAL      20480      20360</span><br></pre></td></tr></table></figure></p>
<h5 id="创建主库rman备份"><a href="#创建主库rman备份" class="headerlink" title="创建主库rman备份"></a>创建主库rman备份</h5><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung01:/home/oracle]$ mkdir -p /worktmp/backup</span><br><span class="line">[oracle@fung01:/home/oracle]$ rman target /</span><br><span class="line">RMAN&gt; backup database format &apos;/worktmp/backup/bfull_%T_%u_%s_%p&apos;;</span><br><span class="line">RMAN&gt; backup current controlfile for standby format &apos;/worktmp/backup/ctl_%T_%u_%s_%p&apos;;</span><br><span class="line">RMAN&gt; sql &apos;alter system archive log current&apos;;</span><br><span class="line">RMAN&gt; backup archivelog all format &apos;/worktmp/backup/arc_%T_%u_%s_%p&apos;;</span><br></pre></td></tr></table></figure>
<p>将备份集传送到备库相同目录，修改pfile，调整相关参数(主要是文件路径)，同时在ASM DATA磁盘组创建相关目录。并启动备库至nomount状态，rman中恢复备库<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung03:/home/oracle]$ rman target sys/oracle@rac11g  auxiliary sys/oracle@stdby</span><br><span class="line">RMAN&gt; duplicate target database for standby nofilenamecheck dorecover;</span><br></pre></td></tr></table></figure></p>
<p>在过程中遇到个问题：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">RMAN&gt; duplicate target database for standby nofilenamecheck dorecover;</span><br><span class="line"></span><br><span class="line">Starting Duplicate Db at 2014-06-04 09:32:04</span><br><span class="line">using target database control file instead of recovery catalog</span><br><span class="line">allocated channel: ORA_AUX_DISK_1</span><br><span class="line">channel ORA_AUX_DISK_1: SID=192 device type=DISK</span><br><span class="line">RMAN-00571: ===========================================================</span><br><span class="line">RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============</span><br><span class="line">RMAN-00571: ===========================================================</span><br><span class="line">RMAN-03002: failure of Duplicate Db command at 06/04/2014 09:32:06</span><br><span class="line">RMAN-05501: aborting duplication of target database</span><br><span class="line">RMAN-06136: ORACLE error from auxiliary database: ORA-00200: control file could not be created</span><br><span class="line">ORA-00202: control file: &apos;+data&apos;</span><br><span class="line">ORA-17502: ksfdcre:4 Failed to create file +data</span><br><span class="line">ORA-15001: diskgroup &quot;DATA&quot; does not exist or is not mounted</span><br><span class="line">ORA-15040: diskgroup is incomplete</span><br><span class="line">ORA-15040: diskgroup is incomplete</span><br></pre></td></tr></table></figure></p>
<p>跟主库对比$ORACLE_HOME/bin/oracle的权限及asmdisk权限，发现都没错：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[oracle@fung03:/home/oracle]$ ls -la $ORACLE_HOME/bin/oracle</span><br><span class="line">-rwxr-x--x 1 oracle oinstall 239627073 May 30 15:00 /u01/app/oracle/product/11gr2//bin/oracle</span><br><span class="line">[oracle@fung01:/home/oracle]$ ls -la $ORACLE_HOME/bin/oracle</span><br><span class="line">-rwsr-s--x 1 oracle asmadmin 239627031 May 30 12:17 /u01/app/oracle/product/11gr2//bin/oracle</span><br><span class="line">[oracle@fung01:/home/oracle]$ ll /dev/asm*</span><br><span class="line">brw-rw---- 1 grid asmadmin 8, 16 Jun  4 09:55 /dev/asm-diskb</span><br><span class="line">brw-rw---- 1 grid asmadmin 8, 32 Jun  4 09:55 /dev/asm-diskc</span><br><span class="line">brw-rw---- 1 grid asmadmin 8, 48 Jun  4 09:55 /dev/asm-diskd</span><br><span class="line">brw-rw---- 1 grid asmadmin 8, 64 Jun  4 09:55 /dev/asm-diske</span><br><span class="line">brw-rw---- 1 grid asmadmin 8, 80 Jun  4 09:55 /dev/asm-diskf</span><br><span class="line">[oracle@fung03:/home/oracle]$ ll /dev/asm*</span><br><span class="line">brw-rw---- 1 grid asmadmin 8, 64 Jun  4 09:51 /dev/asm-diske</span><br><span class="line">brw-rw---- 1 grid asmadmin 8, 80 Jun  4 09:51 /dev/asm-diskf</span><br><span class="line">[oracle@fung03:/home/oracle]$ id oracle</span><br><span class="line">uid=54321(oracle) gid=54321(oinstall) groups=54321(oinstall),54322(dba),54323(asmdba)</span><br><span class="line">[oracle@fung03:/home/oracle]$ id grid</span><br><span class="line">uid=54322(grid) gid=54321(oinstall) groups=54321(oinstall),54322(dba),54323(asmdba),54324(asmadmin)</span><br><span class="line">[oracle@fung01:/home/oracle]$ id oracle</span><br><span class="line">uid=54321(oracle) gid=54321(oinstall) groups=54321(oinstall),54322(dba),54323(asmdba)</span><br><span class="line">[root@fung01 ~]# id grid</span><br><span class="line">uid=54322(grid) gid=54321(oinstall) groups=54321(oinstall),54322(dba),54323(asmdba),54324(asmadmin)</span><br></pre></td></tr></table></figure></p>
<p>备库后台一直报错：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Additional information: 9</span><br><span class="line">ORA-15025: could not open disk &quot;/dev/asm-diskf&quot;</span><br><span class="line">ORA-27041: unable to open file</span><br><span class="line">Linux-x86_64 Error: 13: Permission denied</span><br><span class="line">Additional information: 9</span><br><span class="line">SUCCESS: diskgroup DATA was dismounted</span><br><span class="line">ERROR: diskgroup DATA was not mounted</span><br></pre></td></tr></table></figure></p>
<p>发现是ORACLE_HOME/bin/oracle权限不对，解决方法:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">To correct the proper group for the Database oracle executable, do:</span><br><span class="line">As the &lt;asm_home sfw owner&gt;:</span><br><span class="line">$ cd &lt;asm_home&gt;/bin</span><br><span class="line">$ ./setasmgidwrap o=&lt;db_home&gt;/bin/oracle</span><br></pre></td></tr></table></figure></p>
<p>再次执行duplicate动作，OK了。</p>
<h3 id="8-备库开启实时应用"><a href="#8-备库开启实时应用" class="headerlink" title="8.备库开启实时应用"></a>8.备库开启实时应用</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; shutdown immediate;</span><br><span class="line">SQL&gt; startup nomount</span><br><span class="line">SQL&gt; alter database mount standby database;</span><br><span class="line">SQL&gt; alter database recover managed standby database using current logfile disconnect;</span><br></pre></td></tr></table></figure>
<p>后台日志开始同步<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Completed: alter database recover managed standby database using current logfile disconnect</span><br><span class="line">Media Recovery Log +DATA/arch/1_65_848925414.arc</span><br><span class="line">Media Recovery Log +DATA/arch/2_52_848925414.arc</span><br><span class="line">Media Recovery Log +DATA/arch/2_53_848925414.arc</span><br><span class="line">Media Recovery Log +DATA/arch/1_66_848925414.arc</span><br><span class="line">Media Recovery Log +DATA/arch/2_54_848925414.arc</span><br><span class="line">Media Recovery Log +DATA/arch/2_55_848925414.arc</span><br><span class="line">Media Recovery Waiting for thread 2 sequence 56 (in transit)</span><br><span class="line">Recovery of Online Redo Log: Thread 2 Group 6 Seq 56 Reading mem 0</span><br><span class="line">  Mem# 0: +DATA/stdby/onlinelog/group_6.308.849351751</span><br><span class="line">Media Recovery Waiting for thread 1 sequence 67 (in transit)</span><br><span class="line">Recovery of Online Redo Log: Thread 1 Group 7 Seq 67 Reading mem 0</span><br><span class="line">  Mem# 0: +DATA/stdby/onlinelog/group_7.307.849351753</span><br></pre></td></tr></table></figure></p>
<p>主备库可用以下SQL检测log sequence是否一致：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select name,replace(database_role,&apos; &apos;,&apos;&apos;) as database_role,thread,seq </span><br><span class="line">from  v$database,(select max(sequence#) seq,THREAD# thread  </span><br><span class="line">from v$log_history  group by THREAD#);</span><br></pre></td></tr></table></figure></p>
<p>在主库添加数据文件，备库后台日志会同步相关信息<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create tablespace fung datafile &apos;+DATA&apos; size 10M autoextend off;</span><br><span class="line"></span><br><span class="line">Tablespace created.</span><br><span class="line">#备库日志</span><br><span class="line">Recovery created file +data</span><br><span class="line">Successfully added datafile 6 to media recovery</span><br><span class="line">Datafile # 6: &apos;+DATA/stdby/datafile/fung.325.849353435&apos;</span><br></pre></td></tr></table></figure></p>
<h3 id="9-为备库添加standby-redo-log"><a href="#9-为备库添加standby-redo-log" class="headerlink" title="9.为备库添加standby redo log"></a>9.为备库添加standby redo log</h3><p>为备库添加standby log需要先停止MPR进程，添加完成后再重启MPR进程<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter database recover managed standby database cancel;</span><br><span class="line"></span><br><span class="line">Database altered.</span><br><span class="line"></span><br><span class="line">SQL&gt;  alter database add standby logfile group 5 (&apos;+DATA&apos;) size 50M;</span><br><span class="line">SQL&gt; alter database recover managed standby database using current logfile disconnect;</span><br><span class="line"></span><br><span class="line">Database altered.</span><br><span class="line">SQL&gt; col member for a50</span><br><span class="line">SQL&gt; select member,type from v$logfile;</span><br><span class="line"></span><br><span class="line">MEMBER                                             TYPE</span><br><span class="line">-------------------------------------------------- --------------</span><br><span class="line">+DATA/stdby/onlinelog/group_1.312.849351735        ONLINE</span><br><span class="line">+DATA/stdby/onlinelog/group_2.311.849351739        ONLINE</span><br><span class="line">+DATA/stdby/onlinelog/group_3.313.849351741        ONLINE</span><br><span class="line">+DATA/stdby/onlinelog/group_4.310.849351745        ONLINE</span><br><span class="line">+DATA/stdby/onlinelog/group_5.309.849351747        STANDBY</span><br><span class="line">+DATA/stdby/onlinelog/group_6.308.849351751        STANDBY</span><br><span class="line">+DATA/stdby/onlinelog/group_7.307.849351753        STANDBY</span><br><span class="line">+DATA/stdby/onlinelog/group_8.314.849351757        STANDBY</span><br><span class="line">+DATA/stdby/onlinelog/group_9.306.849351759        STANDBY</span><br><span class="line">+DATA/stdby/onlinelog/group_10.300.849351763       STANDBY</span><br></pre></td></tr></table></figure></p>
<h3 id="10-验证DataGuard"><a href="#10-验证DataGuard" class="headerlink" title="10.验证DataGuard"></a>10.验证DataGuard</h3><p>验证日志是否从主库传输过来，最后一个栏位为yes表示日志已经传输过来<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT RESETLOGS_ID,THREAD#,SEQUENCE#,STATUS,ARCHIVED FROM V$ARCHIVED_LOG;</span><br></pre></td></tr></table></figure></p>
<p>如果日志传输失败，请用以下命令查看主备库日志传输路径是否valid的<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; set line 200</span><br><span class="line">SQL&gt; col dest_name for a20</span><br><span class="line">SQL&gt; col error for a50</span><br><span class="line">SQL&gt; select dest_name,status,error from v$archive_dest where dest_name=&apos;LOG_ARCHIVE_DEST_2&apos;;</span><br><span class="line">DEST_NAME            STATUS             ERROR</span><br><span class="line">-------------------- ------------------ --------------------------------------------------</span><br><span class="line">LOG_ARCHIVE_DEST_2   VALID</span><br></pre></td></tr></table></figure></p>
<p>如果status为其他，则查看是什么原因导致无法归档到备库，调整完后用以下命令重启远程归档进程<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set log_archive_dest_state_2 = &apos;defer&apos;;</span><br><span class="line">SQL&gt; alter system set log_archive_dest_state_2 = &apos;enable&apos;;</span><br></pre></td></tr></table></figure></p>
<p>备库查看lag 延时，正常所有lag应该接近0或者为0<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; col name for a30</span><br><span class="line">SQL&gt; col value for a30</span><br><span class="line">SQL&gt; col datum_time for a30</span><br><span class="line">SQL&gt; col TIME_COMPUTED for a20</span><br><span class="line">SQL&gt; set line 200</span><br><span class="line">SQL&gt; SELECT name, value, datum_time, time_computed FROM V$DATAGUARD_STATS;</span><br><span class="line">NAME                           VALUE                          DATUM_TIME                     TIME_COMPUTED</span><br><span class="line">------------------------------ ------------------------------ ------------------------------ --------------------</span><br><span class="line">transport lag                  +00 00:00:00                   06/04/2014 11:43:01            06/04/2014 11:43:02</span><br><span class="line">apply lag                      +00 00:00:00                   06/04/2014 11:43:01            06/04/2014 11:43:02</span><br><span class="line">apply finish time              +00 00:00:00.000                                              06/04/2014 11:43:02</span><br><span class="line">estimated startup time         33                                                            06/04/2014 11:43:02</span><br></pre></td></tr></table></figure></p>
<p>查看DataGuard message<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; SELECT MESSAGE FROM V$DATAGUARD_STATUS;</span><br><span class="line">MESSAGE</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">Media Recovery Waiting for thread 1 sequence 78 (in transit)</span><br><span class="line">Media Recovery Waiting for thread 2 sequence 59 (in transit)</span><br><span class="line">MRP0: Background Media Recovery cancelled with status 16037</span><br><span class="line">Managed Standby Recovery not using Real Time Apply</span><br><span class="line">MRP0: Background Media Recovery process shutdown</span><br><span class="line">Managed Standby Recovery Canceled</span><br><span class="line">Attempt to start background Managed Standby Recovery process</span><br><span class="line">MRP0: Background Managed Standby Recovery process started</span><br><span class="line">Managed Standby Recovery starting Real Time Apply</span><br><span class="line">Media Recovery Waiting for thread 2 sequence 59 (in transit)</span><br><span class="line">Media Recovery Waiting for thread 1 sequence 78 (in transit)</span><br></pre></td></tr></table></figure></p>
<p>查看日志应用状态<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select thread#,sequence#,applied from v$archived_log;</span><br></pre></td></tr></table></figure></p>
<h3 id="11-11gR2-DataGuard提供实时查询功能"><a href="#11-11gR2-DataGuard提供实时查询功能" class="headerlink" title="11.11gR2 DataGuard提供实时查询功能"></a>11.11gR2 DataGuard提供实时查询功能</h3><h5 id="查看standby目前状态为mount状态"><a href="#查看standby目前状态为mount状态" class="headerlink" title="查看standby目前状态为mount状态"></a>查看standby目前状态为mount状态</h5><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select open_mode from v$database;</span><br><span class="line"></span><br><span class="line">OPEN_MODE</span><br><span class="line">----------------------------------------</span><br><span class="line">MOUNTED</span><br></pre></td></tr></table></figure>
<h5 id="开启实时查询"><a href="#开启实时查询" class="headerlink" title="开启实时查询"></a>开启实时查询</h5><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#暂停MPR进程</span><br><span class="line">SQL&gt; alter database recover managed standby database cancel;</span><br><span class="line">Database altered.</span><br><span class="line">#开启real-time query</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">Database altered.</span><br><span class="line">#开启MPR进程</span><br><span class="line">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE DISCONNECT;</span><br><span class="line">Database altered.</span><br></pre></td></tr></table></figure>
<h5 id="验证实时查询"><a href="#验证实时查询" class="headerlink" title="验证实时查询"></a>验证实时查询</h5><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#主库添加数据</span><br><span class="line">SQL&gt; create table t as select username from dba_users;</span><br><span class="line">Table created.</span><br><span class="line">#备库进行查询</span><br><span class="line">SQL&gt; select open_mode from v$database;</span><br><span class="line"></span><br><span class="line">OPEN_MODE</span><br><span class="line">----------------------------------------</span><br><span class="line">READ ONLY WITH APPLY</span><br><span class="line"></span><br><span class="line">SQL&gt; select * from t;</span><br><span class="line"></span><br><span class="line">USERNAME</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">SYS</span><br><span class="line">SYSTEM</span><br><span class="line">OUTLN</span><br><span class="line">APPQOSSYS</span><br><span class="line">DBSNMP</span><br><span class="line">WMSYS</span><br><span class="line">DIP</span><br><span class="line">ORACLE_OCM</span><br><span class="line"></span><br><span class="line">8 rows selected.</span><br></pre></td></tr></table></figure>
<h3 id="12-删除standby归档脚本"><a href="#12-删除standby归档脚本" class="headerlink" title="12.删除standby归档脚本"></a>12.删除standby归档脚本</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;Media Recovery Log&quot; /u01/app/oracle/diag/rdbms/stdby/rac11g/trace/alert_rac11g.log|sed -e &apos;s/Media Recovery Log/rm -if/g&apos; &gt;/home/oracle/rman/dellog.sh</span><br><span class="line">chmod u+x /home/oracle/rman/dellog.sh</span><br><span class="line">sh  /home/oracle/rman/dellog.sh</span><br><span class="line">cat /u01/app/oracle/diag/rdbms/stdby/rac11g/trace/alert_rac11g.log &gt;&gt;/u01/app/oracle/diag/rdbms/stdby/rac11g/trace/alert_rac11g_old.log</span><br><span class="line">cat /dev/null &gt; /u01/app/oracle/diag/rdbms/stdby/rac11g/trace/alert_rac11g.log</span><br></pre></td></tr></table></figure>
<p>See more details in:<br><a href="http://docs.oracle.com/cd/E11882_01/server.112/e41134/rcmbackp.htm#SBYDB01500" target="_blank" rel="noopener">Oracle® Data Guard Concepts and Administration 11g Release 2 (11.2)</a></p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/dataguard/">#dataguard</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/rman-fundamentals.html">RMAN基础知识</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/duplicate-database-with-rman.html">Duplicate Database With RMAN</a>
            
        </span>
    </div>
    
</article>





    </div>
</section>

    <footer class="footer footer-padding">
    <div class="container content">
            <div class="column is-narrow has-text-centered is-size-7-mobile">
                &copy;  <a href="/">Kyun Kong&nbsp;</a>
                2013 - 2019
            </div>
    </div>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>
-->

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
    
    
    
    

    


<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>