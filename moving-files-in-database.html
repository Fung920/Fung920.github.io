<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Moving Files in database - My Notebook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="how to move different types of files in oracle and DB2 database">



<meta name="keywords" content="move file">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro|Calibri|Ubuntu">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    

    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    My Notebook
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/">Home</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Moving Files in database
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2016-03-24T08:39:59.000Z" itemprop="datePublished">Mar 24 2016</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/database/">database</a>
        </span>
        
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>As a production DBA, we may meet some file moving requirements, such as move a data file from a filesystem to another filesystem, move redo log files, move control files, even move standard file system to ASM. This topic discuss how to relocate those files in Oracle database and how to migrate the whole tablespace in DB2 database.<br><a id="more"></a></p>
<h3 id="1-Relocating-files-in-Oracle-database"><a href="#1-Relocating-files-in-Oracle-database" class="headerlink" title="1. Relocating files in Oracle database"></a>1. Relocating files in Oracle database</h3><p>The most important file types in Oracle database are: data file, control file and redo log file, I&#39;ll show the most common approach to relocate these types of file. </p>
<h4 id="1-1-Moving-datafiles"><a href="#1-1-Moving-datafiles" class="headerlink" title="1.1 Moving datafiles"></a>1.1 Moving datafiles</h4><p>In oracle database 11g and earlier, moving datafiles will affect relevant applications or the whole database. As of Oracle database 12c, a new feature can let you moving the datafiles while the tablespace and the database keeping online. </p>
<ul>
<li>Moving datafiles in 12c </li>
</ul>
<p>With 12c new feature, you can move any datafiles without any downtime, and can move all dafafiles in all tablespaces, including SYSTEM AND SYSAUX. It&#39;s also works with ASM diskgroup.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select INSTANCE_NAME,VERSION,STATUS from v$instance;</span><br><span class="line">INSTANCE_NAME			 VERSION			    STATUS</span><br><span class="line">-------------------------------- ---------------------------------- ------------------------</span><br><span class="line">linora				 12.1.0.2.0			    OPEN</span><br><span class="line"></span><br><span class="line">SQL&gt; select * from v$dbfile where file#=5;</span><br><span class="line">     FILE# NAME 						  CON_ID</span><br><span class="line">---------- -------------------------------------------------- ----------</span><br><span class="line">	 5 /oradata/linora/fung01.dbf				       0</span><br><span class="line"></span><br><span class="line">SQL&gt; alter database move datafile &apos;/oradata/linora/fung01.dbf&apos; to &apos;/data/linora/fung01.dbf&apos;;</span><br><span class="line">--to ASM DG</span><br><span class="line">SQL&gt; alter database move datafile &apos;/oradata/linora/fung01.dbf&apos; to &apos;+DATA&apos;;</span><br><span class="line">SQL&gt; select * from v$dbfile where file#=5;</span><br><span class="line">     FILE# NAME 						  CON_ID</span><br><span class="line">---------- -------------------------------------------------- ----------</span><br><span class="line">	 5 /data/linora/fung01.dbf				       0</span><br></pre></td></tr></table></figure></p>
<p>Previous post also can be referred in RAC or ASM environments: <a href="/rac-datafile-in-local-node.html">RAC Datafile in Local Node</a> .</p>
<ul>
<li>Moving datafiles in 11g or earlier </li>
</ul>
<p>There are two approaches can accomplish this task: with <code>ALTER DATABASE</code> command or with <code>ALTER TABLESPACE</code> command. The difference between the two methods is that ALTER DATABASE need to bring the whole database down, and ALTER TABLESPACE only need to offline the relevant tablespaces.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select INSTANCE_NAME,VERSION,STATUS from v$instance;</span><br><span class="line">INSTANCE_NAME			 VERSION			    STATUS</span><br><span class="line">-------------------------------- ---------------------------------- ------------------------</span><br><span class="line">ora11g				 11.2.0.4.0			    OPEN</span><br><span class="line"></span><br><span class="line">SQL&gt; select * from v$dbfile;</span><br><span class="line">     FILE# NAME</span><br><span class="line">---------- --------------------------------------------------</span><br><span class="line">	 1 /oradata/ora11g/ora11g/system01.dbf</span><br><span class="line">	 2 /oradata/ora11g/ora11g/sysaux01.dbf</span><br><span class="line">	 3 /oradata/ora11g/ora11g/undotbs01.dbf</span><br><span class="line">	 4 /oradata/ora11g/ora11g/fung01.dbf</span><br><span class="line">	 5 /oradata/ora11g/ora11g/users01.dbf</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Moving datafiles with ALTER DATABASE </li>
</ul>
<p>This approach needs to shutdown the instance, because it needs to shutdown the instance, this method can move all the datafiles in all tablespaces including SYSTEM,SYSAUX etc., the general steps as below:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--moving fung01.dbf to /data/ora11g/ora11g</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line">SQL&gt; ! mv /oradata/ora11g/ora11g/fung01.dbf /data/ora11g/ora11g/ </span><br><span class="line">SQL&gt; startup mount</span><br><span class="line">SQL&gt; alter database rename file &apos;/oradata/ora11g/ora11g/fung01.dbf&apos; to &apos;/data/ora11g/ora11g/fung01.dbf&apos;;</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">SQL&gt; select * from v$dbfile where file#=4;</span><br><span class="line">     FILE# NAME</span><br><span class="line">---------- --------------------------------------------------</span><br><span class="line">	 4 /data/ora11g/ora11g/fung01.dbf</span><br><span class="line">--perform an full backup includes controlfiles</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Moving datafiles with ALTER TABLESPACE</li>
</ul>
<p>This approach cannot move SYSTEM,SYSAUX,active undo tablespace and temporary tablespace. With this method, you can keep your database online except the tablespace which datafiles will be moved.  The general steps are as follow:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter tablespace fung offline;</span><br><span class="line">SQL&gt; !mv /data/ora11g/ora11g/fung01.dbf /oradata/ora11g/ora11g/fung01.dbf </span><br><span class="line">SQL&gt; alter tablespace fung rename datafile &apos;/data/ora11g/ora11g/fung01.dbf&apos; to &apos;/oradata/ora11g/ora11g/fung01.dbf&apos;;</span><br><span class="line">SQL&gt; alter tablespace fung online;</span><br><span class="line">SQL&gt; select * from v$dbfile where file#=4;</span><br><span class="line">     FILE# NAME</span><br><span class="line">---------- --------------------------------------------------</span><br><span class="line">	 4 /oradata/ora11g/ora11g/fung01.dbf</span><br></pre></td></tr></table></figure></p>
<h4 id="1-2-Moving-the-redo-log-files"><a href="#1-2-Moving-the-redo-log-files" class="headerlink" title="1.2 Moving the redo log files"></a>1.2 Moving the redo log files</h4><p>Actually, you can just simply delete an entire redo log group and add a new redo log group in a different location <a href="/redo-manage.html">Manage Redo</a> .This approach can be used if database needs to be kept open. Below approach is how to do it when the database shut down.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select * from v$logfile;</span><br><span class="line">    GROUP# STATUS	  TYPE		 MEMBER 					    IS_REC</span><br><span class="line">---------- -------------- -------------- -------------------------------------------------- ------</span><br><span class="line">	 1		  ONLINE	 /oradata/ora11g/ora11g/redo01.log		    NO</span><br><span class="line">	 2		  ONLINE	 /oradata/ora11g/ora11g/redo02.log		    NO</span><br><span class="line">	 3		  ONLINE	 /oradata/ora11g/ora11g/redo03.log		    NO</span><br><span class="line"></span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line">SQL&gt; !mv /oradata/ora11g/ora11g/redo03.log /data/ora11g/ora11g/</span><br><span class="line">SQL&gt; startup mount</span><br><span class="line">SQL&gt; alter database rename file &apos;/oradata/ora11g/ora11g/redo03.log&apos; to &apos;/data/ora11g/ora11g/redo03.log&apos;;</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">SQL&gt; select * from v$logfile;</span><br><span class="line">    GROUP# STATUS	  TYPE		 MEMBER 					    IS_REC</span><br><span class="line">---------- -------------- -------------- -------------------------------------------------- ------</span><br><span class="line">	 1		  ONLINE	 /oradata/ora11g/ora11g/redo01.log		    NO</span><br><span class="line">	 2		  ONLINE	 /oradata/ora11g/ora11g/redo02.log		    NO</span><br><span class="line">	 3		  ONLINE	 /data/ora11g/ora11g/redo03.log 		    NO</span><br></pre></td></tr></table></figure></p>
<h4 id="1-3-Moving-control-files"><a href="#1-3-Moving-control-files" class="headerlink" title="1.3 Moving control files"></a>1.3 Moving control files</h4><p>There are two approaches when moving control files depend on what initial files are you using. When using legacy init file instead of spfile, you need to shutdown the database, move the control file physically, and restart the database.<br>Below method is about how to move the control file when using spfile.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select status,name from v$controlfile;</span><br><span class="line">STATUS	       NAME</span><br><span class="line">-------------- --------------------------------------------------</span><br><span class="line">	       /oradata/ora11g/ora11g/control01.ctl</span><br><span class="line">	       /oradata/ora11g/ora11g/control02.ctl</span><br><span class="line">SQL&gt; show parameter control_files </span><br><span class="line"></span><br><span class="line">NAME		     TYPE		    VALUE</span><br><span class="line">------------------------- ---------------------- ------------------------------</span><br><span class="line">control_files	     string	    /oradata/ora11g/ora11g/control01.ctl, /oradata/ora11g/ora11g/control02.ctl</span><br><span class="line"></span><br><span class="line">SQL&gt; alter system set control_files = &apos;/data/ora11g/ora11g/control01.ctl&apos;,                                          </span><br><span class="line"> &apos;/data/ora11g/ora11g/control02.ctl&apos; scope=spfile;</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line">SQL&gt; !mv /oradata/ora11g/ora11g/control01.ctl /data/ora11g/ora11g/control01.ctl</span><br><span class="line">SQL&gt; !mv /oradata/ora11g/ora11g/control02.ctl /data/ora11g/ora11g/control02.ctl</span><br><span class="line">SQL&gt; startup</span><br><span class="line">SQL&gt; show parameter control_files </span><br><span class="line">NAME				     TYPE		    VALUE</span><br><span class="line">------------------------------------ ---------------------- ------------------------------</span><br><span class="line">control_files			     string		    /data/ora11g/ora11g/control01.</span><br><span class="line">							    ctl, /data/ora11g/ora11g/contr</span><br><span class="line">							    ol02.ctl</span><br><span class="line">SQL&gt; select name from v$controlfile;</span><br><span class="line">NAME</span><br><span class="line">--------------------------------------------------</span><br><span class="line">/data/ora11g/ora11g/control01.ctl</span><br><span class="line">/data/ora11g/ora11g/control02.ctl</span><br></pre></td></tr></table></figure></p>
<h3 id="2-Migrate-the-whole-tablespace-in-DB2-database"><a href="#2-Migrate-the-whole-tablespace-in-DB2-database" class="headerlink" title="2. Migrate the whole tablespace in DB2 database"></a>2. Migrate the whole tablespace in DB2 database</h3><p>Depending on your storage configuration, there are different ways can let you move the tablespace to another location.  As you know, DB2 V10.1 provide <code>ALTER TABLESPACE... USING STOGROUP</code> can relocate the whole tablespace to another storage group when using AUTOMATIC STORAGE MANAGEMENT. Following examples shows how to migrate the tablespace with different methods in different circumstance. </p>
<h4 id="2-1-Migrate-tablespace-in-non-automatic-storage"><a href="#2-1-Migrate-tablespace-in-non-automatic-storage" class="headerlink" title="2.1 Migrate tablespace in non-automatic storage"></a>2.1 Migrate tablespace in non-automatic storage</h4><p>There are three methods about moving tablespace in non-automatic storage.  Below is the original testing environment.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[db2inst1@node1 ~]$ db2pd -d testdb -tablespaces</span><br><span class="line">Tablespace Configuration:</span><br><span class="line">Address            Id    Type Content PageSz ExtentSz Auto Prefetch BufID BufIDDisk FSC NumCntrs MaxStripe  LastConsecPg RSE  Name</span><br><span class="line">0x00007FBAE70EE560 4     DMS  Large   4096   32       Yes  64       1     1         Off 2        0          31           Yes  FUNG</span><br><span class="line">Tablespace Autoresize Statistics:</span><br><span class="line">Address            Id    AS  AR  InitSize             IncSize              IIP MaxSize              LastResize                 LRF</span><br><span class="line">0x00007FBAE70EE560 4     No  No  -4096                0                    No  0                    None                       No </span><br><span class="line">#The AS field is No, mean non-automatic storage</span><br><span class="line">Containers:</span><br><span class="line">Address            TspId ContainNum Type    TotalPgs   UseablePgs PathID     StripeSet  Container </span><br><span class="line">Containers:</span><br><span class="line">Address            TspId ContainNum Type    TotalPgs   UseablePgs PathID     StripeSet  Container </span><br><span class="line">0x00007FBAE70BE240 4     0          File    2560       2528       -          0          /data/db2inst1/NODE0000/SQL00001/fung01.LRG</span><br><span class="line">0x00007FBAE70BE470 4     1          File    2560       2528       -          0          /data/db2inst1/NODE0000/SQL00001/fung02.LRG</span><br></pre></td></tr></table></figure></p>
<p>I&#39;d like to move the tablespace &quot;FUNG&quot; from /data/ to /data2/ file system by using different ways showing as below.  </p>
<ul>
<li>Adding the new containers without rebalance and delete the old containers </li>
</ul>
<p>First, add new containers to the target file system, I use <code>begin new stripe set</code>, this means no rebalancing occur when adding new containers, if you want to add containers to an exist stripe set, use <code> ADD TO STRIPE SET</code> clause.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[db2inst1@node1 ~]$ db2 &quot;alter tablespace fung begin new stripe set(file &apos;/data2/db2inst1/NODE0000/SQL00001/fung01.LRG&apos; 10M,</span><br><span class="line">file &apos;/data2/db2inst1/NODE0000/SQL00001/fung02.LRG&apos; 10M)&quot;</span><br><span class="line"></span><br><span class="line">[db2inst1@node1 ~]$ db2pd -d testdb -tablespaces</span><br><span class="line">Containers:</span><br><span class="line">Address            TspId ContainNum Type    TotalPgs   UseablePgs PathID     StripeSet  Container </span><br><span class="line">0x00007FBAE70C3780 4     0          File    2560       2528       -          0          /data/db2inst1/NODE0000/SQL00001/fung01.LRG</span><br><span class="line">0x00007FBAE70C39B0 4     1          File    2560       2528       -          0          /data/db2inst1/NODE0000/SQL00001/fung02.LRG</span><br><span class="line">0x00007FBAE70C3BE0 4     2          File    2560       2528       -          1          /data2/db2inst1/NODE0000/SQL00001/fung01.LRG</span><br><span class="line">0x00007FBAE70C3E10 4     3          File    2560       2528       -          1          /data2/db2inst1/NODE0000/SQL00001/fung02.LRG</span><br></pre></td></tr></table></figure></p>
<p>Then, drop old containers, rebalanceing will occur automatically in background.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[db2inst1@node1 ~]$ db2 &quot;alter tablespace fung drop ( file &apos;/data/db2inst1/NODE0000/SQL00001/fung01.LRG&apos;, </span><br><span class="line">file &apos;/data/db2inst1/NODE0000/SQL00001/fung02.LRG&apos;)&quot;</span><br></pre></td></tr></table></figure></p>
<p>We can use table function to monitor the rebalance status.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">--As of V10.1</span><br><span class="line">db2 &quot;</span><br><span class="line">select </span><br><span class="line">   varchar(tbsp_name, 30) as tbsp_name, </span><br><span class="line">   dbpartitionnum, </span><br><span class="line">   member, </span><br><span class="line">   rebalancer_mode, </span><br><span class="line">   rebalancer_status, </span><br><span class="line">   rebalancer_extents_remaining, </span><br><span class="line">   rebalancer_extents_processed, </span><br><span class="line">   rebalancer_start_time </span><br><span class="line">from table(mon_get_rebalance_status(NULL,-2)) as t</span><br><span class="line">&quot;</span><br><span class="line">--V9.7 and earlier</span><br><span class="line">db2 &quot;</span><br><span class="line">select </span><br><span class="line">   varchar(tbsp_name, 30) as tbsp_name, </span><br><span class="line">   dbpartitionnum, </span><br><span class="line">   rebalancer_mode, </span><br><span class="line">   rebalancer_extents_remaining, </span><br><span class="line">   rebalancer_extents_processed, </span><br><span class="line">   rebalancer_start_time </span><br><span class="line">from table(snap_get_tbsp_part_v91(NULL,-2)) as t</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Performing a db2relocatedb utility </li>
</ul>
<p>This is a  much quickly way than adding new containers, if you have large data in this tablespace, the rebalancing will last very long time. But relocatedb can minimal the downtime via move physical file directly, this method need to restart the database.    </p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">--configure the relocatedb parameter file as below</span><br><span class="line">[db2inst1@node1 ~]$ cat relocatedb.cfg</span><br><span class="line">DB_NAME=testdb</span><br><span class="line">DB_PATH=/data/</span><br><span class="line">INSTANCE=db2inst1</span><br><span class="line">NODENUM=0</span><br><span class="line">CONT_PATH=/data/db2inst1/NODE0000/SQL00001/fung01.LRG,/data2/db2inst1/NODE0000/SQL00001/fung01.LRG</span><br><span class="line">CONT_PATH=/data/db2inst1/NODE0000/SQL00001/fung02.LRG,/data2/db2inst1/NODE0000/SQL00001/fung02.LRG</span><br><span class="line">--deactivate the database, move the containers physically via OS command </span><br><span class="line">[db2inst1@node1 ~]$ db2 deactivate db testdb</span><br><span class="line">[db2inst1@node1 ~]$ mv /data/db2inst1/NODE0000/SQL00001/fung01.LRG /data2/db2inst1/NODE0000/SQL00001/fung01.LRG</span><br><span class="line">[db2inst1@node1 ~]$ mv /data/db2inst1/NODE0000/SQL00001/fung02.LRG /data2/db2inst1/NODE0000/SQL00001/fung02.LRG</span><br><span class="line">--relocate the database </span><br><span class="line">[db2inst1@node1 ~]$ db2relocatedb -f relocatedb.cfg </span><br><span class="line">Files and control structures were changed successfully.</span><br><span class="line">--activate the database, and verify the result</span><br><span class="line">[db2inst1@node1 ~]$ db2pd -d testdb -tablespaces</span><br><span class="line">...</span><br><span class="line">Containers:</span><br><span class="line">Address            TspId ContainNum Type    TotalPgs   UseablePgs PathID     StripeSet  Container </span><br><span class="line">0x00007FBADFA9A120 4     0          File    2560       2528       -          0          /data2/db2inst1/NODE0000/SQL00001/fung01.LRG</span><br><span class="line">0x00007FBADFA9A350 4     1          File    2560       2528       -          0          /data2/db2inst1/NODE0000/SQL00001/fung02.LRG</span><br></pre></td></tr></table></figure>
<ul>
<li>Redirect restoring the tablespace </li>
</ul>
<p>This is another optional way, backup images and the downtime are required.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">--generate redirect script</span><br><span class="line">[db2inst1@node1 ~]$ db2 &quot;restore db testdb REBUILD WITH all tablespaces in database from /data \</span><br><span class="line">taken at 20160324193845 redirect generate script redirect.clp&quot;</span><br><span class="line">--modify the script of container 4 to</span><br><span class="line">SET TABLESPACE CONTAINERS FOR 4</span><br><span class="line">-- IGNORE ROLLFORWARD CONTAINER OPERATIONS</span><br><span class="line">USING (</span><br><span class="line">  FILE   &apos;/data2/db2inst1/NODE0000/SQL00001/fung01.LRG&apos;                    2560</span><br><span class="line">, FILE   &apos;/data2/db2inst1/NODE0000/SQL00001/fung02.LRG&apos;                    2560</span><br><span class="line">);</span><br><span class="line">--executing redirect script</span><br><span class="line">[db2inst1@node1 ~]$ db2 -tvf redirect.clp</span><br><span class="line">--rollforward the db to end of logs </span><br><span class="line">[db2inst1@node1 ~]$ db2 rollforward db testdb to end of logs and complete</span><br></pre></td></tr></table></figure></p>
<p>By verifying the result, you can find out the container path already changed. </p>
<h4 id="2-2-Migrate-tablespace-in-automatic-storage"><a href="#2-2-Migrate-tablespace-in-automatic-storage" class="headerlink" title="2.2 Migrate tablespace in automatic storage"></a>2.2 Migrate tablespace in automatic storage</h4><p>It&#39;s very simple while relocating the tablespace to another location when using automatic storage, via ALTER TABLESPACE...USING STOGROUP you can simply specify the storage path which you want to move to.  You can also use <code>db2relocatedb</code>, but f you via db2relocatedb tool to relocate the containers, it&#39;s not support CONT_PATH, you need to reloate the whole storage group together.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[db2inst1@node1 ~]$ db2pd -d source -storagepath|grep -i &quot;Group Paths&quot; -A 5</span><br><span class="line">Storage Group Paths: </span><br><span class="line">Address            SGID  PathID    PathState    PathName</span><br><span class="line">0x00007FBB1B348000 0     0         InUse        /db2/data/newstorage</span><br><span class="line">[db2inst1@node1 ~]$ db2pd -d source -tablespaces</span><br><span class="line">Tablespace Configuration:</span><br><span class="line">Address            Id    Type Content PageSz ExtentSz Auto Prefetch BufID BufIDDisk FSC NumCntrs MaxStripe  LastConsecPg RSE  Name</span><br><span class="line">0x00007FBB1E230080 2     DMS  Large   8192   32       Yes  64       1     1         Off 2        0          31           Yes  USERSPACE1</span><br><span class="line">Containers:</span><br><span class="line">Address            TspId ContainNum Type    TotalPgs   UseablePgs PathID     StripeSet  Container </span><br><span class="line">0x00007FBB226F9200 2     0          File    1920       1888       0          0          /db2/data/newstorage/db2inst1/NODE0000/SOURCE/T0000002/C0000002.LRG</span><br></pre></td></tr></table></figure></p>
<p>Assumed my file system &quot;/db2/data/newstorage&quot; is encountered file system full issue, I&#39;d like to move the whole tablespace &quot;USERSPACE1&quot; to another file system &quot;/db2/data/db2inst1&quot;, only 2 steps can accomplish that, and with this method, no need to bring down database, the rebalance will start automatically and will move all tablespace data to the new path in the background.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">--create a storage path in /db2/data/db2inst1</span><br><span class="line">[db2inst1@node1 ~]$ db2 &quot;create stogroup sg2 on &apos;/db2/data/db2inst1&apos;&quot;</span><br><span class="line">--find out the create result</span><br><span class="line">[db2inst1@node1 ~]$ db2  &quot;select substr(SGNAME,1,20) as SGNAME,substr(OWNER,1,10) as owner, \</span><br><span class="line">CREATE_TIME,DEFAULTSG from syscat.stogroups&quot;</span><br><span class="line">SGNAME               OWNER      CREATE_TIME                DEFAULTSG</span><br><span class="line">-------------------- ---------- -------------------------- ---------</span><br><span class="line">IBMSTOGROUP          SYSIBM     2016-03-22-14.03.00.472669 Y        </span><br><span class="line">SG2                  DB2INST1   2016-03-24-17.38.22.583351 N        </span><br><span class="line">--move the tablespace to new storage group</span><br><span class="line">[db2inst1@node1 ~]$ db2 &quot;alter tablespace USERSPACE1 using stogroup sg2&quot;</span><br><span class="line">[db2inst1@node1 ~]$ db2pd -d source -tablespaces</span><br><span class="line">Tablespace Configuration:</span><br><span class="line">Address            Id    Type Content PageSz ExtentSz Auto Prefetch BufID BufIDDisk FSC NumCntrs MaxStripe  LastConsecPg RSE  Name</span><br><span class="line">0x00007FBB1E230080 2     DMS  Large   8192   32       Yes  32       1     1         Off 1        0          31           Yes  USERSPACE1</span><br><span class="line">Containers:</span><br><span class="line">Address            TspId ContainNum Type    TotalPgs   UseablePgs PathID     StripeSet  Container </span><br><span class="line">0x00007FBB226FBCE0 2     0          File    3776       3744       1024       0          /db2/data/db2inst1/db2inst1/NODE0000/SOURCE/T0000002/C0000004.LRG</span><br></pre></td></tr></table></figure></p>
<h4 id="2-3-How-to-find-out-whether-the-tablespace-is-automatic-storage-or-not"><a href="#2-3-How-to-find-out-whether-the-tablespace-is-automatic-storage-or-not" class="headerlink" title="2.3. How to find out whether the tablespace is automatic storage or not"></a>2.3. How to find out whether the tablespace is automatic storage or not</h4><p>Many ways can find out whether the databaspace is AS or not.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db2 &quot;select TBSP_USING_AUTO_STORAGE,tbsp_name from SYSIBMADM.SNAPTBSP&quot;</span><br><span class="line">db2 &quot;select TBSP_USING_AUTO_STORAGE,tbsp_name from SYSIBMADM.TBSP_UTILIZATION&quot;</span><br><span class="line">db2 &quot;select TBSP_USING_AUTO_STORAGE,tbsp_name from SYSIBMADM.MON_TBSP_UTILIZATION&quot;</span><br><span class="line">db2pd -db source -tablespaces #Tablespace Autoresize Statistics field &quot;AS&quot; value &quot;YES&quot;</span><br><span class="line">db2 get snapshot for tablespaces on DB_NAME #Using automatic storage field value &quot;YES&quot;</span><br></pre></td></tr></table></figure></p>
<p><b>EOF</b><br></p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/database/">#database</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/upgrade-single-database-to-12c.html">Upgrade single database to 12c</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/multiple-standby-in-hadr.html">Multiple Standby in HADR</a>
            
        </span>
    </div>
    
</article>




    </div>
</section>
    <footer class="footer footer-padding">
    <div class="container content">
            <div class="column is-narrow has-text-centered is-size-7-mobile">
                &copy; 2013 - 2018
                <a href="/">Fung Kong&nbsp;
                </a>
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
    </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
    
    
    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>